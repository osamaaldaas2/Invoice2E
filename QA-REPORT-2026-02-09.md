# Invoice2E — Full QA Analysis Report

**Date:** 2026-02-09
**Team:** AI QA Team A (Reports-only)
**Scope:** Entire application (all features, all layers)
**Application:** Invoice2E v1.0.0 — AI-powered invoice-to-XRechnung conversion SaaS
**Deployment:** Vercel (Frankfurt, fra1), Supabase (PostgreSQL), Stripe/PayPal, Gemini/DeepSeek AI

---

## Table of Contents

1. [Quality Strategy & Release Readiness (Agent 1)](#report-1--quality-strategist)
2. [UX & Accessibility Review (Agent 2)](#report-2--ux--accessibility-reviewer)
3. [API & Integration Risk (Agent 4)](#report-3--api--integration-analyst)
4. [Exploratory Findings (Agent 5)](#report-4--exploratory-bug-hunter)
5. [Acceptance Readiness (Agent 6)](#report-5--business-flow-validator)
6. [Performance & Reliability Risk (Agent 7)](#report-6--performance--reliability-sentinel)
7. [QA Audit & Traceability (Agent 8)](#report-7--quality-auditor)
8. [Appendix: Severity Scale](#appendix-shared-severity-scale)

---

## Report 1 — Quality Strategist

### Quality Strategy & Release Readiness Report

**Agent:** Quality Strategist (Agent 1)
**Role:** QA Lead / Quality Strategist

#### Scope Covered

Full application review: authentication, invoice extraction (single + batch), review/editing, XRechnung generation, payment processing (Stripe + PayPal), credit system, admin panel, i18n (en/de), deployment configuration.

#### Top Risks

| # | Risk | Severity | Rationale |
|---|------|----------|-----------|
| R1 | **No integration or E2E tests** | **Blocker** | 252 unit tests exist but all use mocks. Zero tests exercise real DB, real API routes end-to-end, or real browser flows. A regression in route wiring, middleware, or DB schema would be invisible to the test suite. |
| R2 | **Three duplicate ExtractedInvoiceData types** | Major | Defined in `gemini.service.ts`, `IAIExtractor.ts`, and `types/index.ts`. A field added to one but missed in another causes silent data loss or build failures. |
| R3 | **Payment double-crediting surface area** | Major | Three separate idempotency layers (webhook_events, verify marker, transaction status) is robust *if* all code paths are exercised. The payment-processor test file has only 3 tests — far too few for the complexity of Stripe + PayPal + verify + webhook flows. |
| R4 | **Batch worker reliability on Vercel** | Major | Fire-and-forget HTTP call to `/api/internal/batch-worker` with a 3-second abort. If the worker fails silently, jobs stay stuck. The self-healing re-trigger (>10s) mitigates this, but there is no dead-letter queue or alerting for permanently stuck jobs. |
| R5 | **No React component tests** | Major | 37 components, 0 component tests. Form validation, conditional rendering, and state transitions are untested in a browser-like environment. |
| R6 | **Credit deduction before conversion completion** | Minor | Credits are deducted at extraction time, not conversion time. If AI extraction succeeds but the user never completes the review/conversion, the credit is lost. This may be intentional (1 credit = 1 extraction attempt), but it creates a support burden. |

#### Quality Gates Status

| Gate | Status | Evidence |
|------|--------|----------|
| Unit tests pass | **PASS** | 252/252 passing, 0 failures |
| Type checking | **PASS** | `tsc --noEmit` configured, strict mode enabled |
| Integration tests | **FAIL** | Placeholder file only, no real tests |
| E2E tests | **FAIL** | Not present |
| Security review | **PASS (with caveats)** | 45+ security bugs fixed (BUG-001 through BUG-045). HMAC sessions, atomic RPC, rate limiting, RLS all present. |
| Performance baseline | **UNKNOWN** | No performance metrics, no load testing evidence |
| Accessibility audit | **UNKNOWN** | ARIA attributes present in code but no automated audit (axe, Lighthouse) |

#### Go/No-Go Recommendation

**Conditional Go** — The application demonstrates strong security practices (signed sessions, atomic credits, idempotency, RLS, rate limiting) and a well-structured codebase. However, the complete absence of integration and E2E tests means regressions can only be caught manually. The recommendation is:

1. **Go** for limited/controlled release with monitoring enabled (Sentry is configured).
2. **No-Go** for high-confidence general availability until integration tests cover the critical payment and extraction paths.

#### Follow-up Actions

- Establish integration test baseline for payment and extraction flows.
- Consolidate the three ExtractedInvoiceData types into one source of truth.
- Add alerting/monitoring for stuck batch jobs (beyond self-healing re-trigger).
- Run an automated accessibility scan (Lighthouse or axe-core).
- Establish a performance baseline (Core Web Vitals, API latency P95).

---

## Report 2 — UX & Accessibility Reviewer

### UX & Accessibility Review Report

**Agent:** UX & Accessibility Reviewer (Agent 2)
**Role:** UI/UX Quality Reviewer (manual)

#### Screens/Flows Reviewed

All 23 pages and 37 components reviewed via source code analysis.

#### Issues Found

| # | Title | Severity | Affected Area |
|---|-------|----------|---------------|
| UX-1 | **No skip-to-content link** | Minor | Accessibility |
| UX-2 | **BulkUploadForm modal lacks focus trap** | Major | Accessibility |
| UX-3 | **No visible focus indicator on some custom elements** | Minor | Accessibility |
| UX-4 | **Drag-and-drop has no keyboard alternative announcement** | Minor | Accessibility |
| UX-5 | **File upload progress bar is simulated (5-90% cap)** | Minor | UX |
| UX-6 | **No confirmation dialog before credit-consuming actions** | Major | UX |
| UX-7 | **Bulk upload JSON editor is a raw textarea** | Minor | UX |
| UX-8 | **No undo/back from conversion page** | Major | UX |
| UX-9 | **Error messages in BulkUploadForm are generic** | Minor | UX |
| UX-10 | **Admin sidebar not keyboard-navigable on mobile** | Minor | Accessibility |
| UX-11 | **Dashboard sidebar items have no aria-current** | Cosmetic | Accessibility |
| UX-12 | **Color-only status indicators (badges)** | Minor | Accessibility |

#### Detailed Findings

**UX-2 (Major):** The BulkUploadForm row review and table review modals are rendered inline (not using the Dialog component) and do not implement focus trapping. A keyboard user can Tab out of the modal into background content while the modal overlay is visible.

**UX-6 (Major):** When a user clicks "Extract" or "Convert," credits are deducted immediately. There is no confirmation step ("This will use 1 credit. Continue?"). Users who accidentally upload the wrong file lose a credit with no recourse.

**UX-8 (Major):** Once a user submits the review form and lands on the `/convert/[extractionId]` page, there is no way to go back and re-edit. If the generated XRechnung has issues, the user must start over.

**UX-5 (Minor):** The upload progress bar animates from 0% to 90% on a timer, then jumps to 100% on response. This is misleading — users may think the upload is 50% done when it's actually waiting for AI processing.

**UX-12 (Minor):** Status badges (Completed=green, Draft=amber, Failed=red) rely on color alone. Users with color blindness may not distinguish statuses. Adding icons or text patterns would help.

#### Accessibility Findings (Basic)

**Positive:**

- ARIA attributes are used extensively: `aria-label`, `aria-required`, `aria-invalid`, `aria-describedby`, `aria-live="polite"`, `role="alert"`, `role="status"`, `role="dialog"`
- Semantic HTML is used consistently (`<form>`, `<label>`, `<button>`, `<table>`)
- Focus ring styling present (`focus-visible:ring-2 focus-visible:ring-sky-400`)
- LoadingSpinner has `role="status"` and `sr-only` text

**Gaps:**

- No skip-to-content link on any page
- No `aria-current="page"` on active navigation items
- Inline modals in BulkUploadForm bypass the accessible Dialog component
- No automated accessibility testing configured (no axe-core, no Lighthouse CI)

#### Usability Risks

- New users get 0 credits on signup (`DEFAULT_CREDITS_ON_SIGNUP = 0`). The first-time experience requires purchasing credits before trying the product. This creates significant friction for onboarding — no trial conversion is possible.
- The invoice review form has 6 sections with many fields. On mobile, this is a very long scroll with no section navigation or progress indicator.

#### Overall UX Quality Assessment

**Good with notable gaps.** The glass-morphism design is visually polished and consistent. Responsive layouts work well. Accessibility foundations are solid (ARIA, semantic HTML). The main gaps are in modal accessibility, credit-consuming action confirmations, and onboarding friction. Recommend addressing UX-2, UX-6, and UX-8 before GA.

---

## Report 3 — API & Integration Analyst

### API & Integration Risk Report

**Agent:** API & Integration Analyst (Agent 4)
**Role:** API/Integration QA Analyst

#### Endpoints/Integrations Covered

70+ API routes across auth, invoices, payments, admin, batch, credits, files, health.

#### Contract & Compatibility Risks

| # | Title | Severity | Area |
|---|-------|----------|------|
| API-1 | **No OpenAPI/Swagger spec** | Major | Documentation |
| API-2 | **Inconsistent response envelope** | Minor | Contract |
| API-3 | **seller* vs supplier* naming drift** | Major | Data consistency |
| API-4 | **PayPal integration status unclear** | Minor | Integration |
| API-5 | **No API versioning** | Minor | Contract |
| API-6 | **Webhook retry handling assumes provider behavior** | Major | Integration |
| API-7 | **Batch worker secret not validated in dev** | Minor | Security |

#### Detailed Findings

**API-1 (Major):** No OpenAPI specification exists. API contracts are defined implicitly by Zod schemas and route handler code. Third-party integrations or future mobile clients would have no formal contract to program against. This also prevents automated contract testing.

**API-2 (Minor):** Response envelopes vary across routes:

- Some return `{ success: true, data: {...} }`
- Some return `{ data: {...} }` directly
- Some return `{ error: "message" }`
- Some return `{ success: false, error: "message" }`

There is no consistent response wrapper.

**API-3 (Major):** The XRechnung types use `supplier*` naming while the rest of the app uses `seller*`. The `mapReviewDataToServiceData()` function maps between them, and `BulkUploadForm.tsx` has fallbacks (`raw.sellerName || raw.supplierName`). This is fragile — any new field must be added in both naming conventions. If a mapping is missed, the XRechnung XML will have empty values.

**API-6 (Major):** The Stripe webhook handler only processes `checkout.session.completed` events. If Stripe sends `checkout.session.expired` or `payment_intent.payment_failed`, these are silently ignored. A payment that fails after the checkout session is created would leave the transaction in `pending` status forever with no user notification.

#### Error-Handling Findings

**Positive:**

- Consistent `handleApiError()` utility across all routes
- Custom error hierarchy (AppError -> ValidationError, NotFoundError, etc.)
- Environment-aware error messages (production hides details)
- Zod validation on all input with clear error messages

**Gaps:**

- No timeout handling on Supabase calls (database queries have a 10s constant defined but it's not enforced via AbortController on every call)
- The `handleApiError` function catches ZodError and generic Error but does not explicitly handle network errors from upstream services (Stripe, PayPal, Gemini)

#### Data-Consistency Risks

| Risk | Description | Impact |
|------|-------------|--------|
| JSONB key naming | `extraction_data` JSONB uses camelCase keys but the recursive `camelToSnakeKeys` converts them. If a new nested field is added that doesn't follow convention, it could silently be mis-cased. | Data loss on retrieval |
| Credit deduction timing | Credits deducted at extraction, not conversion. Batch extraction deducts per file. If batch processing partially fails, some credits are consumed but no invoice is produced. | User dissatisfaction |
| Batch results JSONB | Batch job `results` is a JSONB array. There is no schema validation on this array when reading it back. Corrupted JSON would crash the download route. | Batch download failure |

#### Recommended Verification Areas

- Verify Stripe webhook signature validation against live webhook payloads.
- Verify PayPal order capture flow end-to-end (the order must be captured after approval, not just approved).
- Test the seller* -> supplier* mapping with all XRechnung required fields.
- Verify batch download works when some results have `status: 'failed'`.
- Test expired/failed payment scenarios (not just happy path).

---

## Report 4 — Exploratory Bug Hunter

### Exploratory Findings Report

**Agent:** Exploratory Bug Hunter (Agent 5)
**Role:** Exploratory QA Analyst

#### Areas Explored

- Single-file upload + extraction flow
- Batch upload + review + download flow
- Payment checkout + credit allocation
- Admin user management
- Session management and auth edges
- Error recovery scenarios

#### Issues Found

| # | Title | Severity | Impact | Category |
|---|-------|----------|--------|----------|
| EXP-1 | **Stuck batch jobs with no user recovery** | Major | Users see "Processing" indefinitely | API/Config |
| EXP-2 | **No file type feedback on drag-and-drop rejection** | Minor | User confusion | UI |
| EXP-3 | **History page loads all conversions then filters client-side** | Minor | Performance on large accounts | UI/API |
| EXP-4 | **Admin can refund but credits are not revoked** | Major | Financial integrity | Business flow |
| EXP-5 | **Concurrent extraction requests can over-deduct credits** | Major | Credits go negative | Data |
| EXP-6 | **Session lasts 7 days with no renewal mechanism** | Minor | UX friction | Auth |
| EXP-7 | **No CSRF token on state-changing operations** | Minor | Security | Auth |
| EXP-8 | **Batch download generates XML on-the-fly per request** | Minor | Performance/cost | Performance |
| EXP-9 | **Large batch ZIP (100 files x 25MB) could exceed Vercel memory** | Major | Server crash | Infrastructure |
| EXP-10 | **No email verification on signup** | Minor | Data quality | Auth |

#### Reproduction Narratives

**EXP-1 — Stuck batch jobs:**

A user uploads a ZIP with 50 invoices. The batch worker is triggered via fire-and-forget HTTP with a 3-second AbortController timeout. If Vercel cold-starts the function slowly or the function crashes mid-processing, the batch job remains in `processing` status. The self-healing mechanism (re-trigger if stuck >10s) only fires when the user polls via GET. If the user closes the browser, the job may never complete. There is no server-side scheduler, no dead-letter queue, and no admin tool to manually re-trigger stuck jobs.

**EXP-4 — Refund without credit revocation:**

An admin initiates a refund via `POST /api/admin/transactions/[id]/refund`. The code calls the payment provider's refund API and updates `payment_status` to `'refunded'`. However, the credits that were allocated from this payment are NOT deducted from the user's balance. The user keeps the credits AND gets the money back. Verified by reading the refund route handler — it does not call `safe_deduct_credits` or any credit reversal function.

**EXP-5 — Credit over-deduction race:**

While `safe_deduct_credits` is an atomic RPC (preventing negative balance for a single call), two concurrent extraction requests could both check credits (both see balance=1), then both attempt to deduct. The RPC function handles this atomically, but the credit check *before* calling the RPC is not atomic with the deduction. If the check passes for both requests but only one credit remains, one deduction succeeds and the other fails — but the extraction may have already started (AI call made, resources consumed). The current code does handle this by checking the RPC return value, but the AI extraction may have already been invoked and resources wasted.

**EXP-9 — Memory pressure on large batch:**

Vercel functions have 1024MB memory. A batch of 100 PDF files (max 25MB each = up to 2.5GB total) must be extracted from a ZIP in memory. While JSZip supports streaming, the current implementation loads file buffers into memory for AI processing. With 3 concurrent extractions, peak memory could be 3 x 25MB (files) + ZIP overhead, which should fit in 1024MB for typical PDFs (usually 1-5MB). However, edge cases with very large scanned PDFs could approach limits.

#### Risk Summary

The highest-impact finding is **EXP-4 (refund without credit revocation)** — this is a direct financial integrity issue. **EXP-1 (stuck batch jobs)** affects user trust. **EXP-5** is partially mitigated by the atomic RPC but wastes AI resources on race conditions.

---

## Report 5 — Business Flow Validator

### Acceptance Readiness Report

**Agent:** Business Flow Validator (Agent 6)
**Role:** Business Rules / Acceptance QA Analyst

#### Requirements/Criteria Reviewed

| Business Flow | Status | Notes |
|---------------|--------|-------|
| User registration | **Pass** | Email uniqueness enforced, password strength validated, race condition handled (23505) |
| User login | **Pass** | Rate limited (5/15min), bcrypt verification, session cookie set |
| Single invoice upload | **Pass** | File validation, AI extraction, credit deduction, review redirect |
| Invoice review & editing | **Pass** | 6-section form, field validation, XRechnung spec compliance checks |
| XRechnung generation | **Pass** | CII format, BR-DE rules, per-item tax rates, XML validation |
| Batch upload (ZIP) | **Pass (with caveats)** | ZIP extraction, parallel processing, progress polling, results download |
| Credit purchase (Stripe) | **Pass** | Checkout session, webhook verification, atomic credit addition |
| Credit purchase (PayPal) | **Pass (with caveats)** | Order creation, capture, webhook — but PayPal marked "Phase 2" in .env.example |
| Admin user management | **Pass** | List, detail, ban/unban, credit adjustment, hierarchical protection |
| Admin refund | **Fail** | Refund processed but credits not revoked (see EXP-4) |
| Voucher redemption | **Unknown** | Voucher table exists, redeem endpoint exists, but voucher business rules not fully verified |
| Email notifications | **Unknown** | SendGrid adapter present, templates defined, but no evidence of actual email delivery testing |
| i18n (English + German) | **Pass** | All UI strings localized, locale routing works, language preference stored |

#### Gaps and Ambiguities

| # | Gap | Impact |
|---|-----|--------|
| GAP-1 | **Credit expiry is modeled but not enforced** | `credits_expiry_date` column exists in `user_credits` but no code checks it. Expired credits can still be used. |
| GAP-2 | **No password reset flow** | No "forgot password" page or API endpoint exists. Users who forget their password have no self-service recovery. |
| GAP-3 | **No email verification** | Users can register with any email. No verification link is sent. This could lead to typos in email addresses and inability to receive payment confirmations. |
| GAP-4 | **Template save/load behavior unclear** | Templates page exists, template DB service exists, but the relationship between templates and the review form is unclear. Can users load a template into a new extraction? |
| GAP-5 | **PayPal Phase 2 status** | PayPal is functional in code but marked as "Phase 2" in .env.example with commented-out keys. It's unclear if PayPal should be enabled for release. |
| GAP-6 | **Voucher system completeness** | Vouchers table and admin CRUD exist. The redeem endpoint exists. But: what happens if a voucher gives credits? Is it additive or a discount on purchase? Max uses enforcement? |
| GAP-7 | **UBL format support** | The conversion format can be 'CII' or 'UBL', and a `ubl.service.ts` exists, but the actual UBL generation logic may be incomplete relative to CII. |

#### User-Impact Assessment

**Critical paths working:**

- Upload PDF -> Extract data -> Review -> Generate XRechnung -> Download XML
- Purchase credits -> Stripe checkout -> Credits allocated
- Admin manage users, view analytics

**Broken or incomplete paths:**

- Password recovery (missing entirely)
- Credit expiry (modeled, not enforced)
- Refund + credit clawback (refund works, clawback doesn't)

#### Release Readiness Recommendation

**Conditionally Ready** — Core invoice extraction and conversion flows are functional and well-secured. The credit system works for the happy path. However, GAP-2 (no password reset) is a significant user-facing gap that will generate support tickets immediately. GAP-1 (credit expiry not enforced) may be acceptable if no credits are currently issued with expiry dates. The admin refund bug (EXP-4) must be documented or fixed before release.

---

## Report 6 — Performance & Reliability Sentinel

### Performance & Reliability Risk Report

**Agent:** Performance & Reliability Sentinel (Agent 7)
**Role:** Performance/Reliability QA Analyst

#### Metrics Reviewed and Status

| Metric | Status | Evidence |
|--------|--------|----------|
| Core Web Vitals | **Unknown** | No Lighthouse or CWV data available |
| API response times | **Unknown** | No P50/P95/P99 latency data. Sentry configured with 10% trace sampling. |
| AI extraction latency | **Warn** | 60-second timeout configured. No data on actual P95 latency. |
| Serverless cold start | **Warn** | Vercel Hobby plan, 1024MB memory. No evidence of cold start impact measurement. |
| Database query performance | **Unknown** | 10-second timeout constant defined but not enforced with AbortController. |
| Error rate | **Unknown** | Sentry configured but no dashboard export available. |

#### Top Performance Risks

| # | Risk | Severity | Description |
|---|------|----------|-------------|
| PERF-1 | **AI extraction cold path: 60s timeout** | Major | If Gemini or DeepSeek is slow, users wait up to 60 seconds with a simulated progress bar. No streaming or partial results. |
| PERF-2 | **Batch download generates XML on-the-fly** | Major | Every download request re-generates XRechnung XML for all successful extractions in the batch. For a 100-file batch, this means 100 XML generations + ZIP compression per download click. |
| PERF-3 | **No caching layer for repeated data** | Minor | Package listings, user credits, and dashboard stats are fetched fresh on every request. Only PackageService has a 5-minute cache. |
| PERF-4 | **Rate limiter fallback to in-memory** | Minor | If Redis is unavailable, rate limiting falls back to in-memory — which doesn't work across Vercel serverless function instances (each has its own memory). |
| PERF-5 | **Large ZIP processing in memory** | Major | JSZip loads ZIP contents in memory. A 500MB ZIP with 100 files could cause memory pressure on the 1024MB Vercel function. |

#### Reliability Failure Modes

| # | Failure Mode | Likelihood | Impact | Mitigation |
|---|-------------|------------|--------|------------|
| REL-1 | AI provider outage (Gemini/DeepSeek) | Medium | All extractions fail | Default provider (DeepSeek) with Gemini as alternative. No automatic failover. |
| REL-2 | Supabase outage | Low | All operations fail | No fallback. Sentry would capture errors. |
| REL-3 | Stripe webhook delivery failure | Low | Credits not allocated | Verify endpoint as backup path. Idempotency prevents double-allocation. |
| REL-4 | Vercel function timeout (batch worker) | Medium | Batch jobs incomplete | Self-healing re-trigger on poll. Max 120s per invocation. |
| REL-5 | Redis (Upstash) outage | Low | Rate limiting disabled | In-memory fallback (per-instance only, not distributed). |

#### Release Risk Rating

**Medium Risk** — The application's reliability architecture is reasonable for a Vercel Hobby-plan deployment. The main concerns are:

1. No AI provider automatic failover.
2. Batch processing is fire-and-forget with limited recovery.
3. No performance baseline exists to detect regressions.

#### Monitoring/Rollout Recommendations

- Enable Sentry performance monitoring at a higher sample rate (currently 10%) for the first week.
- Set up Sentry alerts for: extraction timeout rate > 5%, payment webhook failure rate > 0%, batch job stuck > 5 minutes.
- Consider caching batch download results (generated XML) to avoid re-generation on every download.
- Establish a CWV baseline using Vercel Analytics or Lighthouse CI.
- Monitor Vercel function invocation duration and memory usage in the Vercel dashboard.

---

## Report 7 — Quality Auditor

### QA Audit & Traceability Report

**Agent:** Quality Auditor (Agent 8)
**Role:** QA Compliance & Traceability Auditor

#### Coverage Summary (by Area)

| Area | Agents Covering | Depth |
|------|----------------|-------|
| Authentication | Agents 4, 5, 6 | Full — login, signup, session, rate limiting |
| Invoice extraction | Agents 4, 5, 6, 7 | Full — single + batch + multi-invoice |
| Invoice review | Agents 2, 6 | Moderate — form UX + business rules |
| XRechnung generation | Agents 4, 6 | Moderate — contract + acceptance |
| Payment processing | Agents 4, 5, 6 | Full — Stripe + PayPal + webhooks + refund |
| Credit system | Agents 5, 6 | Full — purchase + deduction + race conditions |
| Admin panel | Agents 5, 6 | Moderate — user management + refund |
| Accessibility | Agent 2 | Basic — code review only, no automated scan |
| Performance | Agent 7 | Limited — no metrics available |
| i18n | Agent 6 | Basic — structure verified, translation completeness not audited |

#### Report Quality Issues

| Report | Issue |
|--------|-------|
| Agent 7 (Performance) | Most metrics marked "Unknown" due to lack of data. Report is honest about this but provides limited actionable findings. |
| Agent 2 (UX/A11y) | Review is code-based only. No screenshots or screen recordings were available. Visual issues (contrast ratios, spacing) could not be verified. |
| All agents | No evidence from actual runtime testing. All findings are from static code analysis. Behavioral bugs that only manifest at runtime may be missed. |

#### Traceability Gaps

| Requirement | Covered By | Open Risk |
|-------------|-----------|-----------|
| Password reset | Not covered | **GAP-2**: No implementation exists |
| Email verification | Not covered | **GAP-3**: No implementation exists |
| Credit expiry | Agent 6 | **GAP-1**: Modeled but not enforced |
| Voucher system | Agent 6 | **GAP-6**: Completeness unknown |
| UBL format | Agent 6 | **GAP-7**: Implementation completeness unknown |

#### Consolidated Risk Register

| ID | Risk | Severity | Source Agent(s) | Status |
|----|------|----------|----------------|--------|
| R1 | No integration/E2E tests | Blocker | Agent 1 | Open |
| EXP-4 | Refund without credit revocation | Major | Agent 5 | Open |
| API-3 | seller*/supplier* naming drift | Major | Agent 4 | Open (mitigated by mapping) |
| GAP-2 | No password reset flow | Major | Agent 6 | Open |
| UX-2 | Modal focus trap missing | Major | Agent 2 | Open |
| UX-6 | No confirmation before credit-consuming actions | Major | Agent 2 | Open |
| UX-8 | No back/undo from conversion | Major | Agent 2 | Open |
| API-6 | Expired/failed payment events ignored | Major | Agent 4 | Open |
| EXP-1 | Stuck batch jobs with no recovery | Major | Agent 5 | Open (partially mitigated) |
| EXP-9 | Large batch ZIP memory pressure | Major | Agents 5, 7 | Open |
| PERF-2 | Batch download re-generates XML | Major | Agent 7 | Open |
| GAP-1 | Credit expiry not enforced | Minor | Agent 6 | Open |
| GAP-3 | No email verification | Minor | Agent 6 | Open |
| R5 | No component tests | Major | Agent 1 | Open |
| PERF-1 | 60s AI extraction timeout UX | Major | Agent 7 | Open |

#### Severity Consistency Check

All agents used the shared severity scale correctly:

- **Blocker**: Only R1 (no integration tests) — appropriate, as this prevents confident release.
- **Major**: Financial integrity (EXP-4), data consistency (API-3), missing features (GAP-2), accessibility barriers (UX-2).
- **Minor**: Cosmetic UX, minor gaps, edge cases with workarounds.
- **Cosmetic**: Only UX-11 (missing aria-current).

Severity usage is **consistent** across all reports.

#### Audit Verdict

**WARN** — The application demonstrates strong engineering practices (signed sessions, atomic operations, rate limiting, comprehensive error hierarchy, 252 unit tests). The security posture is mature with 45+ documented and fixed security bugs. However, the absence of integration tests (R1), the refund-without-credit-revocation bug (EXP-4), and the missing password reset flow (GAP-2) represent significant quality gaps that should be addressed. The codebase is release-ready for a controlled launch with known limitations documented, but not for unrestricted general availability.

---

## Appendix: Shared Severity Scale

| Level | Definition |
|-------|------------|
| **Blocker** | Prevents core user journey or release cannot proceed |
| **Major** | Significant user impact or data correctness risk |
| **Minor** | Workaround exists; limited impact |
| **Cosmetic** | Visual/text issue; no functional impact |

---

**End of Full QA Analysis — Invoice2E v1.0.0**
