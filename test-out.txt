
[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/osama/Desktop/Invoice2E.1[39m

 [32mâœ“[39m tests/unit/lib/sanitizer.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 128[2mms[22m[39m
 [32mâœ“[39m tests/unit/routes/batch-worker.route.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 844[2mms[22m[39m
   [33m[2mâœ“[22m[39m Batch worker route (C-1 secret enforcement)[2m > [22mreturns 401 when BATCH_WORKER_SECRET is unset [33m 803[2mms[22m[39m
[90mstdout[2m | tests/unit/pdf-splitter.service.test.ts[2m > [22m[2mPdfSplitterService[2m > [22m[2msplitByPageGroups[2m > [22m[2mshould split a 4-page PDF into 2 groups
[22m[39m{"timestamp":"2026-02-19T15:11:06.194Z","level":"INFO","message":"PDF split completed","data":{"sourcePages":4,"groups":2,"groupSizes":[2,2]}}

[90mstdout[2m | tests/unit/pdf-splitter.service.test.ts[2m > [22m[2mPdfSplitterService[2m > [22m[2msplitByPageGroups[2m > [22m[2mshould handle single-page groups
[22m[39m{"timestamp":"2026-02-19T15:11:06.219Z","level":"INFO","message":"PDF split completed","data":{"sourcePages":3,"groups":3,"groupSizes":[1,1,1]}}

[90mstdout[2m | tests/unit/pdf-splitter.service.test.ts[2m > [22m[2mPdfSplitterService[2m > [22m[2msplitByPageGroups[2m > [22m[2mshould handle uneven page groups
[22m[39m{"timestamp":"2026-02-19T15:11:06.231Z","level":"INFO","message":"PDF split completed","data":{"sourcePages":5,"groups":2,"groupSizes":[3,2]}}

 [32mâœ“[39m tests/unit/pdf-splitter.service.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 78[2mms[22m[39m
[90mstdout[2m | .agent/skills/scripts/tests/validate_skills_headings.test.js
[22m[39mChecking YAML validity for 853 skills...
ok

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mquarantine[2m > [22m[2mshould store file and create entry
[22m[39m{"timestamp":"2026-02-19T15:11:07.191Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"14981e67-7585-4fd9-9689-bfb5bb99dd86","originalName":"invoice.pdf","size":1024}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould pass a valid PDF file
[22m[39m{"timestamp":"2026-02-19T15:11:07.201Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"f8a43927-909d-4d10-8c10-4832bde59bb3","originalName":"invoice.pdf","size":1024}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould pass a valid PDF file
[22m[39m{"timestamp":"2026-02-19T15:11:07.202Z","level":"INFO","message":"File scan completed","data":{"quarantineId":"f8a43927-909d-4d10-8c10-4832bde59bb3","isClean":true,"checks":[{"name":"file_size","passed":true},{"name":"extension_allowlist","passed":true},{"name":"mime_type_allowlist","passed":true},{"name":"magic_bytes","passed":true}]}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould pass a valid PNG file
[22m[39m{"timestamp":"2026-02-19T15:11:07.204Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"8cf165c1-49c6-4506-8b9f-f4d05ccd924b","originalName":"receipt.png","size":1024}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould pass a valid PNG file
[22m[39m{"timestamp":"2026-02-19T15:11:07.204Z","level":"INFO","message":"File scan completed","data":{"quarantineId":"8cf165c1-49c6-4506-8b9f-f4d05ccd924b","isClean":true,"checks":[{"name":"file_size","passed":true},{"name":"extension_allowlist","passed":true},{"name":"mime_type_allowlist","passed":true},{"name":"magic_bytes","passed":true}]}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould pass a valid JPEG file
[22m[39m{"timestamp":"2026-02-19T15:11:07.205Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"4fad0062-53ec-4ba8-82c8-a38bf82d310a","originalName":"photo.jpg","size":1024}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould pass a valid JPEG file
[22m[39m{"timestamp":"2026-02-19T15:11:07.205Z","level":"INFO","message":"File scan completed","data":{"quarantineId":"4fad0062-53ec-4ba8-82c8-a38bf82d310a","isClean":true,"checks":[{"name":"file_size","passed":true},{"name":"extension_allowlist","passed":true},{"name":"mime_type_allowlist","passed":true},{"name":"magic_bytes","passed":true}]}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould reject file with invalid extension
[22m[39m{"timestamp":"2026-02-19T15:11:07.206Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"664c9935-a77b-4d04-8682-4bb67394b239","originalName":"malware.exe","size":1024}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould reject file with invalid extension
[22m[39m{"timestamp":"2026-02-19T15:11:07.206Z","level":"INFO","message":"File scan completed","data":{"quarantineId":"664c9935-a77b-4d04-8682-4bb67394b239","isClean":false,"checks":[{"name":"file_size","passed":true},{"name":"extension_allowlist","passed":false},{"name":"mime_type_allowlist","passed":true},{"name":"magic_bytes","passed":true}]}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould reject file with magic bytes mismatch
[22m[39m{"timestamp":"2026-02-19T15:11:07.207Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"4657e107-1bea-4591-8471-e5b04fe5bc26","originalName":"fake.pdf","size":1024}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould reject file with magic bytes mismatch
[22m[39m{"timestamp":"2026-02-19T15:11:07.207Z","level":"INFO","message":"File scan completed","data":{"quarantineId":"4657e107-1bea-4591-8471-e5b04fe5bc26","isClean":false,"checks":[{"name":"file_size","passed":true},{"name":"extension_allowlist","passed":true},{"name":"mime_type_allowlist","passed":true},{"name":"magic_bytes","passed":false}]}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould reject oversized file
[22m[39m{"timestamp":"2026-02-19T15:11:07.208Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"7a5602d6-9f8b-47c7-bc9b-fcf4a4010ac9","originalName":"invoice.pdf","size":27262976}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould reject oversized file
[22m[39m{"timestamp":"2026-02-19T15:11:07.208Z","level":"INFO","message":"File scan completed","data":{"quarantineId":"7a5602d6-9f8b-47c7-bc9b-fcf4a4010ac9","isClean":false,"checks":[{"name":"file_size","passed":false},{"name":"extension_allowlist","passed":true},{"name":"mime_type_allowlist","passed":true},{"name":"magic_bytes","passed":true}]}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould reject file with disallowed MIME type
[22m[39m{"timestamp":"2026-02-19T15:11:07.209Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"21049f52-ecc2-4a34-bbb5-5bab4bd501eb","originalName":"doc.html","size":1024}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould reject file with disallowed MIME type
[22m[39m{"timestamp":"2026-02-19T15:11:07.209Z","level":"INFO","message":"File scan completed","data":{"quarantineId":"21049f52-ecc2-4a34-bbb5-5bab4bd501eb","isClean":false,"checks":[{"name":"file_size","passed":true},{"name":"extension_allowlist","passed":false},{"name":"mime_type_allowlist","passed":false},{"name":"magic_bytes","passed":false}]}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould throw when scanning non-quarantined entry
[22m[39m{"timestamp":"2026-02-19T15:11:07.210Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"d6b74c46-20b2-4a5a-86e7-4c4327308c98","originalName":"invoice.pdf","size":1024}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mscan[2m > [22m[2mshould throw when scanning non-quarantined entry
[22m[39m{"timestamp":"2026-02-19T15:11:07.210Z","level":"INFO","message":"File scan completed","data":{"quarantineId":"d6b74c46-20b2-4a5a-86e7-4c4327308c98","isClean":true,"checks":[{"name":"file_size","passed":true},{"name":"extension_allowlist","passed":true},{"name":"mime_type_allowlist","passed":true},{"name":"magic_bytes","passed":true}]}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mpromote[2m > [22m[2mshould promote a clean file
[22m[39m{"timestamp":"2026-02-19T15:11:07.211Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"f53ebeb6-3dd2-4a30-94fc-386c107e67ff","originalName":"invoice.pdf","size":1024}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mpromote[2m > [22m[2mshould promote a clean file
[22m[39m{"timestamp":"2026-02-19T15:11:07.211Z","level":"INFO","message":"File scan completed","data":{"quarantineId":"f53ebeb6-3dd2-4a30-94fc-386c107e67ff","isClean":true,"checks":[{"name":"file_size","passed":true},{"name":"extension_allowlist","passed":true},{"name":"mime_type_allowlist","passed":true},{"name":"magic_bytes","passed":true}]}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mpromote[2m > [22m[2mshould promote a clean file
[22m[39m{"timestamp":"2026-02-19T15:11:07.212Z","level":"INFO","message":"File promoted to production","data":{"quarantineId":"f53ebeb6-3dd2-4a30-94fc-386c107e67ff","productionPath":"/production/f53ebeb6-3dd2-4a30-94fc-386c107e67ff/invoice.pdf"}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mpromote[2m > [22m[2mshould throw when promoting non-clean file
[22m[39m{"timestamp":"2026-02-19T15:11:07.212Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"cd09a6f6-cae0-450f-8677-49c04cbd1681","originalName":"invoice.pdf","size":1024}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mreject[2m > [22m[2mshould reject a quarantined file with reason
[22m[39m{"timestamp":"2026-02-19T15:11:07.213Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"9d44b9be-1eaa-4562-9272-9e77df9ae508","originalName":"invoice.pdf","size":1024}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mreject[2m > [22m[2mshould reject a quarantined file with reason
[22m[39m{"timestamp":"2026-02-19T15:11:07.214Z","level":"INFO","message":"File rejected","data":{"quarantineId":"9d44b9be-1eaa-4562-9272-9e77df9ae508","reason":"Manual review: suspicious content"}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mreject[2m > [22m[2mshould throw when rejecting promoted file
[22m[39m{"timestamp":"2026-02-19T15:11:07.217Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"faf62dc8-630e-41c6-9c8c-9e54b789ad99","originalName":"invoice.pdf","size":1024}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mreject[2m > [22m[2mshould throw when rejecting promoted file
[22m[39m{"timestamp":"2026-02-19T15:11:07.217Z","level":"INFO","message":"File scan completed","data":{"quarantineId":"faf62dc8-630e-41c6-9c8c-9e54b789ad99","isClean":true,"checks":[{"name":"file_size","passed":true},{"name":"extension_allowlist","passed":true},{"name":"mime_type_allowlist","passed":true},{"name":"magic_bytes","passed":true}]}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mreject[2m > [22m[2mshould throw when rejecting promoted file
[22m[39m{"timestamp":"2026-02-19T15:11:07.217Z","level":"INFO","message":"File promoted to production","data":{"quarantineId":"faf62dc8-630e-41c6-9c8c-9e54b789ad99","productionPath":"/production/faf62dc8-630e-41c6-9c8c-9e54b789ad99/invoice.pdf"}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mreject[2m > [22m[2mshould throw on empty reason
[22m[39m{"timestamp":"2026-02-19T15:11:07.218Z","level":"INFO","message":"File quarantined","data":{"quarantineId":"dbb93d90-3aa6-4846-b0cb-8c62ab0eacef","originalName":"invoice.pdf","size":1024}}

[90mstdout[2m | lib/file-quarantine.test.ts[2m > [22m[2mQuarantineService[2m > [22m[2mcleanup[2m > [22m[2mshould clean expired entries
[22m[39m{"timestamp":"2026-02-19T15:11:07.219Z","level":"INFO","message":"Quarantine cleanup completed","data":{"cleaned":1,"total":1}}

 [32mâœ“[39m lib/gdpr/gdpr.test.ts [2m([22m[2m29 tests[22m[2m)[22m[32m 35[2mms[22m[39m
 [32mâœ“[39m lib/file-quarantine.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 36[2mms[22m[39m
 [32mâœ“[39m tests/unit/routes/auth.signup.route.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 37[2mms[22m[39m
[90mstdout[2m | tests/unit/adapters/mistral.adapter.test.ts[2m > [22m[2mMistralAdapter[2m > [22m[2mextractInvoiceData[2m > [22m[2mshould perform two-step extraction (OCR + Chat)
[22m[39m{"timestamp":"2026-02-19T15:11:07.435Z","level":"INFO","message":"Mistral extraction started","data":{"mimeType":"application/pdf","bufferSize":4}}

[90mstdout[2m | tests/unit/adapters/mistral.adapter.test.ts[2m > [22m[2mMistralAdapter[2m > [22m[2mextractInvoiceData[2m > [22m[2mshould perform two-step extraction (OCR + Chat)
[22m[39m{"timestamp":"2026-02-19T15:11:07.442Z","level":"INFO","message":"Mistral extraction successful","data":{"processingTimeMs":7,"confidence":0.7}}

[90mstdout[2m | tests/unit/adapters/mistral.adapter.test.ts[2m > [22m[2mMistralAdapter[2m > [22m[2msendPrompt[2m > [22m[2mshould use local text extraction then send prompt to chat
[22m[39m{"timestamp":"2026-02-19T15:11:07.541Z","level":"INFO","message":"sendPrompt using flat text extraction","data":{"source":"unpdf","textLength":23}}

 [32mâœ“[39m tests/unit/adapters/mistral.adapter.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 113[2mms[22m[39m
[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mshould generate valid XML for complete invoice data
[22m[39m{"timestamp":"2026-02-19T15:11:08.079Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INV-001"}}
{"timestamp":"2026-02-19T15:11:08.088Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INV-001","xmlSize":6854,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mshould reject missing invoice number
[22m[39m{"timestamp":"2026-02-19T15:11:08.092Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":null}}

[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mshould reject missing invoice date
[22m[39m{"timestamp":"2026-02-19T15:11:08.094Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INV-001"}}

[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mshould reject invalid total amount
[22m[39m{"timestamp":"2026-02-19T15:11:08.094Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INV-001"}}

[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mshould reject empty line items
[22m[39m{"timestamp":"2026-02-19T15:11:08.095Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INV-001"}}

[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mshould escape XML special characters correctly
[22m[39m{"timestamp":"2026-02-19T15:11:08.096Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INV-001"}}
{"timestamp":"2026-02-19T15:11:08.096Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INV-001","xmlSize":6889,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mshould format dates correctly (YYYYMMDD)
[22m[39m{"timestamp":"2026-02-19T15:11:08.099Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INV-001"}}
{"timestamp":"2026-02-19T15:11:08.099Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INV-001","xmlSize":6854,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mA: Mixed VAT invoices (7% + 19%)[2m > [22m[2mMIX-001 Goods + Books: should generate valid XML
[22m[39m{"timestamp":"2026-02-19T15:11:08.089Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-MIX-001"}}
{"timestamp":"2026-02-19T15:11:08.099Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-MIX-001","xmlSize":8666,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mshould handle missing optional fields gracefully
[22m[39m{"timestamp":"2026-02-19T15:11:08.101Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INV-001"}}
{"timestamp":"2026-02-19T15:11:08.101Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INV-001","xmlSize":6961,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mshould include tax breakdown calculations
[22m[39m{"timestamp":"2026-02-19T15:11:08.105Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INV-001"}}
{"timestamp":"2026-02-19T15:11:08.105Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INV-001","xmlSize":6854,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mA: Mixed VAT invoices (7% + 19%)[2m > [22m[2mMIX-001 Goods + Books: XML should contain multiple tax breakdowns
[22m[39m{"timestamp":"2026-02-19T15:11:08.106Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-MIX-001"}}
{"timestamp":"2026-02-19T15:11:08.107Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-MIX-001","xmlSize":8666,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mshould map buyerElectronicAddress to XML URIUniversalCommunication with correct scheme
[22m[39m{"timestamp":"2026-02-19T15:11:08.107Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INV-001"}}
{"timestamp":"2026-02-19T15:11:08.107Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INV-001","xmlSize":6863,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mshould use auto-detected scheme 0204 for non-email buyerElectronicAddress
[22m[39m{"timestamp":"2026-02-19T15:11:08.111Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INV-001"}}
{"timestamp":"2026-02-19T15:11:08.111Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INV-001","xmlSize":6857,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mA: Mixed VAT invoices (7% + 19%)[2m > [22m[2mMIX-002 Software + Catering: should generate valid XML
[22m[39m{"timestamp":"2026-02-19T15:11:08.111Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-MIX-002"}}
{"timestamp":"2026-02-19T15:11:08.111Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-MIX-002","xmlSize":8663,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mT5: should default to EM scheme for non-PEPPOL, non-email electronic address
[22m[39m{"timestamp":"2026-02-19T15:11:08.114Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INV-001"}}
{"timestamp":"2026-02-19T15:11:08.114Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INV-001","xmlSize":6858,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mA: Mixed VAT invoices (7% + 19%)[2m > [22m[2mMIX-002 Software + Catering: XML should contain multiple tax breakdowns
[22m[39m{"timestamp":"2026-02-19T15:11:08.116Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-MIX-002"}}
{"timestamp":"2026-02-19T15:11:08.117Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-MIX-002","xmlSize":8663,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mA: Mixed VAT invoices (7% + 19%)[2m > [22m[2mMIX-003 Hardware + Shipping: should generate valid XML
[22m[39m{"timestamp":"2026-02-19T15:11:08.119Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-MIX-003"}}
{"timestamp":"2026-02-19T15:11:08.119Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-MIX-003","xmlSize":10024,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mT5: should use explicit scheme when provided (seller)
[22m[39m{"timestamp":"2026-02-19T15:11:08.117Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INV-001"}}
{"timestamp":"2026-02-19T15:11:08.118Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INV-001","xmlSize":6858,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mA: Mixed VAT invoices (7% + 19%)[2m > [22m[2mMIX-003 Hardware + Shipping: XML should contain multiple tax breakdowns
[22m[39m{"timestamp":"2026-02-19T15:11:08.122Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-MIX-003"}}
{"timestamp":"2026-02-19T15:11:08.122Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-MIX-003","xmlSize":10024,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung.service.test.ts[2m > [22m[2mXRechnungService[2m > [22m[2mgenerateXRechnung[2m > [22m[2mshould use recomputed total (not raw totalAmount) for GrandTotalAmount (F1)
[22m[39m{"timestamp":"2026-02-19T15:11:08.123Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INV-001"}}
{"timestamp":"2026-02-19T15:11:08.124Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INV-001","xmlSize":6854,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mA: Mixed VAT invoices (7% + 19%)[2m > [22m[2mMIX-004 3 items at 19% + 2 items at 7%: should generate valid XML
[22m[39m{"timestamp":"2026-02-19T15:11:08.124Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-MIX-004"}}
{"timestamp":"2026-02-19T15:11:08.125Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-MIX-004","xmlSize":12750,"warnings":0}}

 [32mâœ“[39m tests/unit/xrechnung.service.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 49[2mms[22m[39m
[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mA: Mixed VAT invoices (7% + 19%)[2m > [22m[2mMIX-004 3 items at 19% + 2 items at 7%: XML should contain multiple tax breakdowns
[22m[39m{"timestamp":"2026-02-19T15:11:08.127Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-MIX-004"}}
{"timestamp":"2026-02-19T15:11:08.127Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-MIX-004","xmlSize":12750,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mA: Mixed VAT invoices (7% + 19%)[2m > [22m[2mMIX-005 Small amounts 7% + 19%: should generate valid XML
[22m[39m{"timestamp":"2026-02-19T15:11:08.129Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-MIX-005"}}
{"timestamp":"2026-02-19T15:11:08.130Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-MIX-005","xmlSize":8622,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mA: Mixed VAT invoices (7% + 19%)[2m > [22m[2mMIX-005 Small amounts 7% + 19%: XML should contain multiple tax breakdowns
[22m[39m{"timestamp":"2026-02-19T15:11:08.131Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-MIX-005"}}
{"timestamp":"2026-02-19T15:11:08.132Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-MIX-005","xmlSize":8622,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mB: Credit Notes (documentTypeCode 381)[2m > [22m[2mCN-001 Simple refund (19%): should generate valid XML with TypeCode 381
[22m[39m{"timestamp":"2026-02-19T15:11:08.134Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-CN-001"}}
{"timestamp":"2026-02-19T15:11:08.134Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-CN-001","xmlSize":7065,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mB: Credit Notes (documentTypeCode 381)[2m > [22m[2mCN-002 Multi-line refund (mixed rates): should generate valid XML with TypeCode 381
[22m[39m{"timestamp":"2026-02-19T15:11:08.136Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-CN-002"}}
{"timestamp":"2026-02-19T15:11:08.136Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-CN-002","xmlSize":8811,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mB: Credit Notes (documentTypeCode 381)[2m > [22m[2mCN-003 Partial refund (19%): should generate valid XML with TypeCode 381
[22m[39m{"timestamp":"2026-02-19T15:11:08.138Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-CN-003"}}
{"timestamp":"2026-02-19T15:11:08.138Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-CN-003","xmlSize":7073,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mC: Missing IBAN (should fail BR-DE-23-a)[2m > [22m[2mNOIBAN-001 Empty IBAN: generateXRechnung should throw ValidationError
[22m[39m{"timestamp":"2026-02-19T15:11:08.142Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-NOIBAN-001"}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mC: Missing IBAN (should fail BR-DE-23-a)[2m > [22m[2mNOIBAN-002 Null IBAN: generateXRechnung should throw ValidationError
[22m[39m{"timestamp":"2026-02-19T15:11:08.144Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-NOIBAN-002"}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mC: Missing IBAN (should fail BR-DE-23-a)[2m > [22m[2mNOIBAN-003 Undefined IBAN: generateXRechnung should throw ValidationError
[22m[39m{"timestamp":"2026-02-19T15:11:08.145Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-NOIBAN-003"}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mD: Missing Buyer Electronic Address (should fail PEPPOL-EN16931-R010)[2m > [22m[2mNOENDPOINT-001 No buyer electronic address: generateXRechnung should throw ValidationError
[22m[39m{"timestamp":"2026-02-19T15:11:08.147Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-NOENDPOINT-001"}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mD: Missing Buyer Electronic Address (should fail PEPPOL-EN16931-R010)[2m > [22m[2mNOENDPOINT-002 Null buyer electronic address: generateXRechnung should throw ValidationError
[22m[39m{"timestamp":"2026-02-19T15:11:08.148Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-NOENDPOINT-002"}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mD: Missing Buyer Electronic Address (should fail PEPPOL-EN16931-R010)[2m > [22m[2mNOENDPOINT-003 No seller electronic address: generateXRechnung should throw ValidationError
[22m[39m{"timestamp":"2026-02-19T15:11:08.148Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-NOENDPOINT-003"}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mF: Zero-rated (Z) and Reverse charge (AE)[2m > [22m[2mF1 ZERORATED-Z-001: should generate valid XML
[22m[39m{"timestamp":"2026-02-19T15:11:08.149Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"ZERORATED-Z-001"}}
{"timestamp":"2026-02-19T15:11:08.150Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"ZERORATED-Z-001","xmlSize":8371,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mF: Zero-rated (Z) and Reverse charge (AE)[2m > [22m[2mF1 ZERORATED-Z-001: XML should contain CategoryCode Z
[22m[39m{"timestamp":"2026-02-19T15:11:08.152Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"ZERORATED-Z-001"}}
{"timestamp":"2026-02-19T15:11:08.153Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"ZERORATED-Z-001","xmlSize":8371,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mF: Zero-rated (Z) and Reverse charge (AE)[2m > [22m[2mF1 ZERORATED-Z-001: XML should contain ExemptionReason for Z
[22m[39m{"timestamp":"2026-02-19T15:11:08.154Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"ZERORATED-Z-001"}}
{"timestamp":"2026-02-19T15:11:08.154Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"ZERORATED-Z-001","xmlSize":8371,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mF: Zero-rated (Z) and Reverse charge (AE)[2m > [22m[2mF1 ZERORATED-Z-001: XML should contain RateApplicablePercent 0.00
[22m[39m{"timestamp":"2026-02-19T15:11:08.157Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"ZERORATED-Z-001"}}
{"timestamp":"2026-02-19T15:11:08.157Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"ZERORATED-Z-001","xmlSize":8371,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mF: Zero-rated (Z) and Reverse charge (AE)[2m > [22m[2mF1 ZERORATED-Z-001: XML should have TaxTotalAmount = 0 and GrandTotal = subtotal
[22m[39m{"timestamp":"2026-02-19T15:11:08.160Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"ZERORATED-Z-001"}}
{"timestamp":"2026-02-19T15:11:08.160Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"ZERORATED-Z-001","xmlSize":8371,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mF: Zero-rated (Z) and Reverse charge (AE)[2m > [22m[2mF2 REVERSE-AE-001: should generate valid XML
[22m[39m{"timestamp":"2026-02-19T15:11:08.162Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"REVERSE-AE-001"}}
{"timestamp":"2026-02-19T15:11:08.163Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"REVERSE-AE-001","xmlSize":8594,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mF: Zero-rated (Z) and Reverse charge (AE)[2m > [22m[2mF2 REVERSE-AE-001: XML should contain CategoryCode AE
[22m[39m{"timestamp":"2026-02-19T15:11:08.164Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"REVERSE-AE-001"}}
{"timestamp":"2026-02-19T15:11:08.164Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"REVERSE-AE-001","xmlSize":8594,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mF: Zero-rated (Z) and Reverse charge (AE)[2m > [22m[2mF2 REVERSE-AE-001: XML should contain ExemptionReason for AE
[22m[39m{"timestamp":"2026-02-19T15:11:08.166Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"REVERSE-AE-001"}}
{"timestamp":"2026-02-19T15:11:08.166Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"REVERSE-AE-001","xmlSize":8594,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mF: Zero-rated (Z) and Reverse charge (AE)[2m > [22m[2mF2 REVERSE-AE-001: XML should contain RateApplicablePercent 0.00
[22m[39m{"timestamp":"2026-02-19T15:11:08.167Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"REVERSE-AE-001"}}
{"timestamp":"2026-02-19T15:11:08.168Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"REVERSE-AE-001","xmlSize":8594,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mF: Zero-rated (Z) and Reverse charge (AE)[2m > [22m[2mF2 REVERSE-AE-001: XML should have TaxTotalAmount = 0 and GrandTotal = subtotal
[22m[39m{"timestamp":"2026-02-19T15:11:08.169Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"REVERSE-AE-001"}}
{"timestamp":"2026-02-19T15:11:08.170Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"REVERSE-AE-001","xmlSize":8594,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mF: Zero-rated (Z) and Reverse charge (AE)[2m > [22m[2mF2 REVERSE-AE-001: XML should contain buyer VAT ID
[22m[39m{"timestamp":"2026-02-19T15:11:08.172Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"REVERSE-AE-001"}}
{"timestamp":"2026-02-19T15:11:08.172Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"REVERSE-AE-001","xmlSize":8594,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mINTRA-K-001: should generate valid XML
[22m[39m{"timestamp":"2026-02-19T15:11:08.174Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INTRA-K-001"}}
{"timestamp":"2026-02-19T15:11:08.174Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INTRA-K-001","xmlSize":8549,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mINTRA-K-001: XML should contain CategoryCode K
[22m[39m{"timestamp":"2026-02-19T15:11:08.177Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INTRA-K-001"}}
{"timestamp":"2026-02-19T15:11:08.177Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INTRA-K-001","xmlSize":8549,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mINTRA-K-001: XML should contain ExemptionReason for K
[22m[39m{"timestamp":"2026-02-19T15:11:08.178Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INTRA-K-001"}}
{"timestamp":"2026-02-19T15:11:08.179Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INTRA-K-001","xmlSize":8549,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mINTRA-K-001: XML should contain RateApplicablePercent 0.00
[22m[39m{"timestamp":"2026-02-19T15:11:08.181Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INTRA-K-001"}}
{"timestamp":"2026-02-19T15:11:08.181Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INTRA-K-001","xmlSize":8549,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mINTRA-K-001: XML should have TaxTotalAmount = 0 and GrandTotal = subtotal
[22m[39m{"timestamp":"2026-02-19T15:11:08.183Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INTRA-K-001"}}
{"timestamp":"2026-02-19T15:11:08.183Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INTRA-K-001","xmlSize":8549,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mINTRA-K-001: XML should contain buyer VAT ID
[22m[39m{"timestamp":"2026-02-19T15:11:08.186Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"INTRA-K-001"}}
{"timestamp":"2026-02-19T15:11:08.186Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"INTRA-K-001","xmlSize":8549,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mEXPORT-G-001: should generate valid XML
[22m[39m{"timestamp":"2026-02-19T15:11:08.188Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"EXPORT-G-001"}}
{"timestamp":"2026-02-19T15:11:08.189Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"EXPORT-G-001","xmlSize":8387,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mEXPORT-G-001: XML should contain CategoryCode G
[22m[39m{"timestamp":"2026-02-19T15:11:08.191Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"EXPORT-G-001"}}
{"timestamp":"2026-02-19T15:11:08.192Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"EXPORT-G-001","xmlSize":8387,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mEXPORT-G-001: XML should contain ExemptionReason for G
[22m[39m{"timestamp":"2026-02-19T15:11:08.193Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"EXPORT-G-001"}}
{"timestamp":"2026-02-19T15:11:08.193Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"EXPORT-G-001","xmlSize":8387,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mEXPORT-G-001: XML should contain RateApplicablePercent 0.00
[22m[39m{"timestamp":"2026-02-19T15:11:08.197Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"EXPORT-G-001"}}
{"timestamp":"2026-02-19T15:11:08.198Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"EXPORT-G-001","xmlSize":8387,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mEXPORT-G-001: XML should have TaxTotalAmount = 0 and GrandTotal = subtotal
[22m[39m{"timestamp":"2026-02-19T15:11:08.199Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"EXPORT-G-001"}}
{"timestamp":"2026-02-19T15:11:08.200Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"EXPORT-G-001","xmlSize":8387,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mNOTSUBJ-O-001: should generate valid XML
[22m[39m{"timestamp":"2026-02-19T15:11:08.203Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"NOTSUBJ-O-001"}}
{"timestamp":"2026-02-19T15:11:08.203Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"NOTSUBJ-O-001","xmlSize":8387,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mNOTSUBJ-O-001: XML should contain CategoryCode O
[22m[39m{"timestamp":"2026-02-19T15:11:08.205Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"NOTSUBJ-O-001"}}
{"timestamp":"2026-02-19T15:11:08.205Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"NOTSUBJ-O-001","xmlSize":8387,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mNOTSUBJ-O-001: XML should contain ExemptionReason for O
[22m[39m{"timestamp":"2026-02-19T15:11:08.208Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"NOTSUBJ-O-001"}}
{"timestamp":"2026-02-19T15:11:08.209Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"NOTSUBJ-O-001","xmlSize":8387,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mNOTSUBJ-O-001: XML should contain RateApplicablePercent 0.00
[22m[39m{"timestamp":"2026-02-19T15:11:08.211Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"NOTSUBJ-O-001"}}
{"timestamp":"2026-02-19T15:11:08.211Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"NOTSUBJ-O-001","xmlSize":8387,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mNOTSUBJ-O-001: XML should have TaxTotalAmount = 0 and GrandTotal = subtotal
[22m[39m{"timestamp":"2026-02-19T15:11:08.214Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"NOTSUBJ-O-001"}}
{"timestamp":"2026-02-19T15:11:08.214Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"NOTSUBJ-O-001","xmlSize":8387,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mCANARY-L-001: should generate valid XML
[22m[39m{"timestamp":"2026-02-19T15:11:08.215Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"CANARY-L-001"}}
{"timestamp":"2026-02-19T15:11:08.216Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"CANARY-L-001","xmlSize":8408,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mCANARY-L-001: XML should contain CategoryCode L
[22m[39m{"timestamp":"2026-02-19T15:11:08.217Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"CANARY-L-001"}}
{"timestamp":"2026-02-19T15:11:08.218Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"CANARY-L-001","xmlSize":8408,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mCANARY-L-001: XML should contain ExemptionReason for L
[22m[39m{"timestamp":"2026-02-19T15:11:08.219Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"CANARY-L-001"}}
{"timestamp":"2026-02-19T15:11:08.219Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"CANARY-L-001","xmlSize":8408,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mCANARY-L-001: XML should contain RateApplicablePercent 0.00
[22m[39m{"timestamp":"2026-02-19T15:11:08.222Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"CANARY-L-001"}}
{"timestamp":"2026-02-19T15:11:08.222Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"CANARY-L-001","xmlSize":8408,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mG: Intra-community (K), Export (G), Not subject (O), Canary Islands (L)[2m > [22m[2mCANARY-L-001: XML should have TaxTotalAmount = 0 and GrandTotal = subtotal
[22m[39m{"timestamp":"2026-02-19T15:11:08.225Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"CANARY-L-001"}}
{"timestamp":"2026-02-19T15:11:08.225Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"CANARY-L-001","xmlSize":8408,"warnings":0}}

[90mstdout[2m | tests/unit/xrechnung-fixtures.test.ts[2m > [22m[2mE: Edge cases[2m > [22m[2mZero-rate line item with taxCategoryCode E (exempt)
[22m[39m{"timestamp":"2026-02-19T15:11:08.228Z","level":"INFO","message":"Starting XRechnung 3.0 generation (EN 16931 compliant)","data":{"invoiceNumber":"TEST-EDGE-EXEMPT"}}
{"timestamp":"2026-02-19T15:11:08.229Z","level":"INFO","message":"XRechnung generated successfully","data":{"invoiceNumber":"TEST-EDGE-EXEMPT","xmlSize":6979,"warnings":0}}

 [32mâœ“[39m tests/unit/xrechnung-fixtures.test.ts [2m([22m[2m75 tests[22m[2m)[22m[32m 151[2mms[22m[39m
[90mstdout[2m | lib/api-keys/api-keys.test.ts[2m > [22m[2mApiKeyService[2m > [22m[2mcreateApiKey[2m > [22m[2mshould create a key and return it once
[22m[39m{"timestamp":"2026-02-19T15:11:08.900Z","level":"INFO","message":"API key created","data":{"userId":"550e8400-e29b-41d4-a716-446655440000","keyId":"ce943443-5519-475c-9e21-ab8a3f76f6be"}}

[90mstdout[2m | lib/api-keys/api-keys.test.ts[2m > [22m[2mApiKeyService[2m > [22m[2mvalidateApiKey[2m > [22m[2mshould validate a correctly created key
[22m[39m{"timestamp":"2026-02-19T15:11:08.908Z","level":"INFO","message":"API key created","data":{"userId":"550e8400-e29b-41d4-a716-446655440000","keyId":"bddf2280-ec24-447d-baba-bd4a6fc09c48"}}

[90mstdout[2m | lib/api-keys/api-keys.test.ts[2m > [22m[2mApiKeyService[2m > [22m[2mvalidateApiKey[2m > [22m[2mshould reject expired key
[22m[39m{"timestamp":"2026-02-19T15:11:08.910Z","level":"INFO","message":"API key created","data":{"userId":"550e8400-e29b-41d4-a716-446655440000","keyId":"76e3a1c4-add3-4c55-81d4-bb2a9fb9e557"}}

[90mstdout[2m | lib/api-keys/api-keys.test.ts[2m > [22m[2mApiKeyService[2m > [22m[2mvalidateApiKey[2m > [22m[2mshould reject expired key
[22m[39m{"timestamp":"2026-02-19T15:11:08.910Z","level":"INFO","message":"API key expired","data":{"keyId":"76e3a1c4-add3-4c55-81d4-bb2a9fb9e557"}}

[90mstdout[2m | lib/api-keys/api-keys.test.ts[2m > [22m[2mApiKeyService[2m > [22m[2mrevokeKey[2m > [22m[2mshould revoke an existing key
[22m[39m{"timestamp":"2026-02-19T15:11:08.911Z","level":"INFO","message":"API key created","data":{"userId":"550e8400-e29b-41d4-a716-446655440000","keyId":"5fe89f02-e51c-4b02-9874-001241bfadad"}}

[90mstdout[2m | lib/api-keys/api-keys.test.ts[2m > [22m[2mApiKeyService[2m > [22m[2mrevokeKey[2m > [22m[2mshould revoke an existing key
[22m[39m{"timestamp":"2026-02-19T15:11:08.911Z","level":"INFO","message":"API key revoked","data":{"keyId":"5fe89f02-e51c-4b02-9874-001241bfadad","userId":"550e8400-e29b-41d4-a716-446655440000"}}

[90mstdout[2m | lib/api-keys/api-keys.test.ts[2m > [22m[2mApiKeyService[2m > [22m[2mlistKeys[2m > [22m[2mshould list keys without exposing raw keys
[22m[39m{"timestamp":"2026-02-19T15:11:08.912Z","level":"INFO","message":"API key created","data":{"userId":"550e8400-e29b-41d4-a716-446655440000","keyId":"9a96c56f-0730-4bb9-ad06-84fc15b8bba8"}}

[90mstdout[2m | lib/api-keys/api-keys.test.ts[2m > [22m[2mApiKeyService[2m > [22m[2mlistKeys[2m > [22m[2mshould list keys without exposing raw keys
[22m[39m{"timestamp":"2026-02-19T15:11:08.912Z","level":"INFO","message":"API key created","data":{"userId":"550e8400-e29b-41d4-a716-446655440000","keyId":"c7a7ec74-1923-4e7a-8a05-749c14abfe9a"}}

[90mstdout[2m | lib/api-keys/api-keys.test.ts[2m > [22m[2mApiKeyService[2m > [22m[2mrotateKey[2m > [22m[2mshould revoke old key and create new one with same scopes
[22m[39m{"timestamp":"2026-02-19T15:11:08.913Z","level":"INFO","message":"API key created","data":{"userId":"550e8400-e29b-41d4-a716-446655440000","keyId":"e6a30683-fff4-4b41-950c-9676d23adf12"}}

[90mstdout[2m | lib/api-keys/api-keys.test.ts[2m > [22m[2mApiKeyService[2m > [22m[2mrotateKey[2m > [22m[2mshould revoke old key and create new one with same scopes
[22m[39m{"timestamp":"2026-02-19T15:11:08.914Z","level":"INFO","message":"API key revoked","data":{"keyId":"e6a30683-fff4-4b41-950c-9676d23adf12","userId":"550e8400-e29b-41d4-a716-446655440000"}}

[90mstdout[2m | lib/api-keys/api-keys.test.ts[2m > [22m[2mApiKeyService[2m > [22m[2mrotateKey[2m > [22m[2mshould revoke old key and create new one with same scopes
[22m[39m{"timestamp":"2026-02-19T15:11:08.914Z","level":"INFO","message":"API key created","data":{"userId":"550e8400-e29b-41d4-a716-446655440000","keyId":"f435a449-7b44-4dd8-9929-98466011ccb0"}}

[90mstdout[2m | lib/api-keys/api-keys.test.ts[2m > [22m[2mApiKeyService[2m > [22m[2mscope checking[2m > [22m[2mshould correctly validate scopes on created key
[22m[39m{"timestamp":"2026-02-19T15:11:08.915Z","level":"INFO","message":"API key created","data":{"userId":"550e8400-e29b-41d4-a716-446655440000","keyId":"c101755c-612f-409d-a2c8-25c490c3fc21"}}

 [32mâœ“[39m lib/api-keys/api-keys.test.ts [2m([22m[2m23 tests[22m[2m)[22m[32m 25[2mms[22m[39m
[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: xrechnung-cii[2m > [22m[2mgenerates without throwing
[22m[39m{"timestamp":"2026-02-19T15:11:10.151Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-cii","name":"XRechnung 3.0 (CII)"}}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mgenerates valid UBL 2.1 XML
[22m[39m{"timestamp":"2026-02-19T15:11:10.153Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.161Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mhas correct PEPPOL CustomizationID
[22m[39m{"timestamp":"2026-02-19T15:11:10.162Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.163Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: xrechnung-cii[2m > [22m[2mreturns non-empty content
[22m[39m{"timestamp":"2026-02-19T15:11:10.162Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-cii","name":"XRechnung 3.0 (CII)"}}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mdoes NOT contain XRechnung CustomizationID
[22m[39m{"timestamp":"2026-02-19T15:11:10.163Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.163Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mhas correct ProfileID
[22m[39m{"timestamp":"2026-02-19T15:11:10.164Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.164Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mdoes NOT include Leitweg-ID
[22m[39m{"timestamp":"2026-02-19T15:11:10.164Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.165Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mhandles non-EUR currency (SEK)
[22m[39m{"timestamp":"2026-02-19T15:11:10.165Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.165Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mhandles GBP currency
[22m[39m{"timestamp":"2026-02-19T15:11:10.166Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.166Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mhandles NOK currency
[22m[39m{"timestamp":"2026-02-19T15:11:10.166Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.166Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mzero-tax (exempt)[2m > [22m[2mxrechnung-cii â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.156Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-cii","name":"XRechnung 3.0 (CII)"}}

[90mstdout[2m | tests/unit/cross-format-consistency.test.ts[2m > [22m[2mCross-Format Consistency
[22m[39m{"timestamp":"2026-02-19T15:11:10.155Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-cii","name":"XRechnung 3.0 (CII)"}}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: xrechnung-ubl[2m > [22m[2mgenerates without throwing
[22m[39m{"timestamp":"2026-02-19T15:11:10.164Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-ubl","name":"XRechnung 3.0 (UBL)"}}
{"timestamp":"2026-02-19T15:11:10.165Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"CROSS-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.166Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mhandles DKK currency
[22m[39m{"timestamp":"2026-02-19T15:11:10.167Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.167Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2mgenerates PDF output with pdfContent buffer
[22m[39m{"timestamp":"2026-02-19T15:11:10.154Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mincludes EndpointID elements
[22m[39m{"timestamp":"2026-02-19T15:11:10.167Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.167Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: xrechnung-ubl[2m > [22m[2mreturns non-empty content
[22m[39m{"timestamp":"2026-02-19T15:11:10.167Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-ubl","name":"XRechnung 3.0 (UBL)"}}
{"timestamp":"2026-02-19T15:11:10.167Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"CROSS-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.167Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mincludes required elements: InvoiceNumber, IssueDate, Currency
[22m[39m{"timestamp":"2026-02-19T15:11:10.167Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.168Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/golden-files.test.ts[2m > [22m[2mGolden File Tests[2m > [22m[2mformat: xrechnung-cii[2m > [22m[2mmatches golden file (or creates it)
[22m[39m{"timestamp":"2026-02-19T15:11:10.156Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-cii","name":"XRechnung 3.0 (CII)"}}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mincludes line items
[22m[39m{"timestamp":"2026-02-19T15:11:10.168Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.168Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: peppol-bis[2m > [22m[2mgenerates without throwing
[22m[39m{"timestamp":"2026-02-19T15:11:10.168Z","level":"INFO","message":"Format generator created","data":{"format":"peppol-bis","name":"PEPPOL BIS Billing 3.0"}}
{"timestamp":"2026-02-19T15:11:10.168Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"CROSS-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.168Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mgenerates credit notes (TypeCode 381) correctly
[22m[39m{"timestamp":"2026-02-19T15:11:10.168Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.169Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mgenerates correct filename with _peppol suffix
[22m[39m{"timestamp":"2026-02-19T15:11:10.169Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.169Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: peppol-bis[2m > [22m[2mreturns non-empty content
[22m[39m{"timestamp":"2026-02-19T15:11:10.169Z","level":"INFO","message":"Format generator created","data":{"format":"peppol-bis","name":"PEPPOL BIS Billing 3.0"}}
{"timestamp":"2026-02-19T15:11:10.169Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"CROSS-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.169Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mreports correct file size
[22m[39m{"timestamp":"2026-02-19T15:11:10.169Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.169Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mhandles allowances/charges
[22m[39m{"timestamp":"2026-02-19T15:11:10.170Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.170Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPeppolBISGenerator[2m > [22m[2mvalidate()[2m > [22m[2mpasses for valid PEPPOL XML
[22m[39m{"timestamp":"2026-02-19T15:11:10.170Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"PEPP-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.171Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format-consistency.test.ts[2m > [22m[2mCross-Format Consistency
[22m[39m{"timestamp":"2026-02-19T15:11:10.169Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-ubl","name":"XRechnung 3.0 (UBL)"}}
{"timestamp":"2026-02-19T15:11:10.169Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"CONSIST-2024-007"}}
{"timestamp":"2026-02-19T15:11:10.171Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format-consistency.test.ts[2m > [22m[2mCross-Format Consistency
[22m[39m{"timestamp":"2026-02-19T15:11:10.171Z","level":"INFO","message":"Format generator created","data":{"format":"peppol-bis","name":"PEPPOL BIS Billing 3.0"}}
{"timestamp":"2026-02-19T15:11:10.171Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"CONSIST-2024-007"}}
{"timestamp":"2026-02-19T15:11:10.172Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mzero-tax (exempt)[2m > [22m[2mxrechnung-ubl â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.170Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-ubl","name":"XRechnung 3.0 (UBL)"}}
{"timestamp":"2026-02-19T15:11:10.171Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-ZEROTAX-001"}}
{"timestamp":"2026-02-19T15:11:10.172Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: facturx-en16931[2m > [22m[2mgenerates without throwing
[22m[39m{"timestamp":"2026-02-19T15:11:10.170Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-en16931","name":"Factur-X EN 16931 (Comfort)"}}
{"timestamp":"2026-02-19T15:11:10.170Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"CROSS-2024-001"}}

[90mstdout[2m | tests/unit/golden-files.test.ts[2m > [22m[2mGolden File Tests[2m > [22m[2mformat: xrechnung-ubl[2m > [22m[2mmatches golden file (or creates it)
[22m[39m{"timestamp":"2026-02-19T15:11:10.170Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-ubl","name":"XRechnung 3.0 (UBL)"}}
{"timestamp":"2026-02-19T15:11:10.171Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"GOLDEN-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.172Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mzero-tax (exempt)[2m > [22m[2mpeppol-bis â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.173Z","level":"INFO","message":"Format generator created","data":{"format":"peppol-bis","name":"PEPPOL BIS Billing 3.0"}}
{"timestamp":"2026-02-19T15:11:10.173Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-ZEROTAX-001"}}
{"timestamp":"2026-02-19T15:11:10.173Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format-consistency.test.ts[2m > [22m[2mCross-Format Consistency
[22m[39m{"timestamp":"2026-02-19T15:11:10.172Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-en16931","name":"Factur-X EN 16931 (Comfort)"}}
{"timestamp":"2026-02-19T15:11:10.172Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"CONSIST-2024-007"}}

[90mstdout[2m | tests/unit/golden-files.test.ts[2m > [22m[2mGolden File Tests[2m > [22m[2mformat: peppol-bis[2m > [22m[2mmatches golden file (or creates it)
[22m[39m{"timestamp":"2026-02-19T15:11:10.174Z","level":"INFO","message":"Format generator created","data":{"format":"peppol-bis","name":"PEPPOL BIS Billing 3.0"}}
{"timestamp":"2026-02-19T15:11:10.174Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"GOLDEN-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.174Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mzero-tax (exempt)[2m > [22m[2mfacturx-en16931 â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.174Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-en16931","name":"Factur-X EN 16931 (Comfort)"}}
{"timestamp":"2026-02-19T15:11:10.174Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"EDGE-ZEROTAX-001"}}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPEPPOL BIS factory registration[2m > [22m[2mGeneratorFactory.create("peppol-bis") returns PeppolBISGenerator
[22m[39m{"timestamp":"2026-02-19T15:11:10.178Z","level":"INFO","message":"Format generator created","data":{"format":"peppol-bis","name":"PEPPOL BIS Billing 3.0"}}

[90mstdout[2m | tests/unit/peppol-bis.test.ts[2m > [22m[2mPEPPOL BIS factory registration[2m > [22m[2mreturns cached singleton for peppol-bis
[22m[39m{"timestamp":"2026-02-19T15:11:10.179Z","level":"INFO","message":"Format generator created","data":{"format":"peppol-bis","name":"PEPPOL BIS Billing 3.0"}}

 [32mâœ“[39m tests/unit/peppol-bis.test.ts [2m([22m[2m37 tests[22m[2m)[22m[32m 30[2mms[22m[39m
[90mstdout[2m | tests/unit/golden-files.test.ts[2m > [22m[2mGolden File Tests[2m > [22m[2mformat: facturx-en16931[2m > [22m[2mmatches golden file (or creates it)
[22m[39m{"timestamp":"2026-02-19T15:11:10.176Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-en16931","name":"Factur-X EN 16931 (Comfort)"}}
{"timestamp":"2026-02-19T15:11:10.176Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"GOLDEN-2024-001"}}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2mgenerates valid PDF that pdf-lib can parse
[22m[39m{"timestamp":"2026-02-19T15:11:10.231Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: facturx-en16931[2m > [22m[2mreturns non-empty content
[22m[39m{"timestamp":"2026-02-19T15:11:10.234Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-en16931","name":"Factur-X EN 16931 (Comfort)"}}
{"timestamp":"2026-02-19T15:11:10.234Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"CROSS-2024-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mzero-tax (exempt)[2m > [22m[2mfacturx-basic â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.234Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-basic","name":"Factur-X Basic"}}
{"timestamp":"2026-02-19T15:11:10.234Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"EDGE-ZEROTAX-001"}}

[90mstdout[2m | tests/unit/cross-format-consistency.test.ts[2m > [22m[2mCross-Format Consistency
[22m[39m{"timestamp":"2026-02-19T15:11:10.239Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-basic","name":"Factur-X Basic"}}
{"timestamp":"2026-02-19T15:11:10.239Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"CONSIST-2024-007"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mzero-tax (exempt)[2m > [22m[2mfatturapa â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.245Z","level":"INFO","message":"Format generator created","data":{"format":"fatturapa","name":"FatturaPA 1.2 (Italy)"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mzero-tax (exempt)[2m > [22m[2mksef â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.248Z","level":"INFO","message":"Format generator created","data":{"format":"ksef","name":"KSeF FA(2) â€” Poland"}}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: facturx-basic[2m > [22m[2mgenerates without throwing
[22m[39m{"timestamp":"2026-02-19T15:11:10.248Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-basic","name":"Factur-X Basic"}}
{"timestamp":"2026-02-19T15:11:10.248Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"CROSS-2024-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mzero-tax (exempt)[2m > [22m[2mnlcius â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.249Z","level":"INFO","message":"Format generator created","data":{"format":"nlcius","name":"NLCIUS / SI-UBL 2.0 (Netherlands)"}}
{"timestamp":"2026-02-19T15:11:10.250Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-ZEROTAX-001"}}
{"timestamp":"2026-02-19T15:11:10.250Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mzero-tax (exempt)[2m > [22m[2mcius-ro â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.250Z","level":"INFO","message":"Format generator created","data":{"format":"cius-ro","name":"CIUS-RO (Romania)"}}
{"timestamp":"2026-02-19T15:11:10.250Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-ZEROTAX-001"}}
{"timestamp":"2026-02-19T15:11:10.251Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2mPDF filename ends with _facturx.pdf
[22m[39m{"timestamp":"2026-02-19T15:11:10.250Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/cross-format-consistency.test.ts[2m > [22m[2mCross-Format Consistency
[22m[39m{"timestamp":"2026-02-19T15:11:10.251Z","level":"INFO","message":"Format generator created","data":{"format":"fatturapa","name":"FatturaPA 1.2 (Italy)"}}

[90mstdout[2m | tests/unit/cross-format-consistency.test.ts[2m > [22m[2mCross-Format Consistency
[22m[39m{"timestamp":"2026-02-19T15:11:10.253Z","level":"INFO","message":"Format generator created","data":{"format":"ksef","name":"KSeF FA(2) â€” Poland"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mcredit note (381)[2m > [22m[2mxrechnung-ubl â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.253Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-CN-001"}}
{"timestamp":"2026-02-19T15:11:10.254Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format-consistency.test.ts[2m > [22m[2mCross-Format Consistency
[22m[39m{"timestamp":"2026-02-19T15:11:10.254Z","level":"INFO","message":"Format generator created","data":{"format":"nlcius","name":"NLCIUS / SI-UBL 2.0 (Netherlands)"}}
{"timestamp":"2026-02-19T15:11:10.254Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"CONSIST-2024-007"}}
{"timestamp":"2026-02-19T15:11:10.254Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mcredit note (381)[2m > [22m[2mpeppol-bis â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.254Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-CN-001"}}
{"timestamp":"2026-02-19T15:11:10.254Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format-consistency.test.ts[2m > [22m[2mCross-Format Consistency
[22m[39m{"timestamp":"2026-02-19T15:11:10.255Z","level":"INFO","message":"Format generator created","data":{"format":"cius-ro","name":"CIUS-RO (Romania)"}}
{"timestamp":"2026-02-19T15:11:10.255Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"CONSIST-2024-007"}}
{"timestamp":"2026-02-19T15:11:10.255Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mcredit note (381)[2m > [22m[2mfacturx-en16931 â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.258Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"EDGE-CN-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mcredit note (381)[2m > [22m[2mfacturx-basic â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.267Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"EDGE-CN-001"}}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2mfileSize matches pdfContent length
[22m[39m{"timestamp":"2026-02-19T15:11:10.276Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mcredit note (381)[2m > [22m[2mnlcius â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.276Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-CN-001"}}
{"timestamp":"2026-02-19T15:11:10.276Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mcredit note (381)[2m > [22m[2mcius-ro â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.277Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-CN-001"}}
{"timestamp":"2026-02-19T15:11:10.277Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format-consistency.test.ts[2m > [22m[2mCross-Format Consistency[2m > [22m[2mFactur-X formats embed XML in PDF
[22m[39m{"timestamp":"2026-02-19T15:11:10.278Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"CONSIST-2024-007"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mmulti-tax-rate[2m > [22m[2mxrechnung-ubl â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.279Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-MULTITAX-001"}}
{"timestamp":"2026-02-19T15:11:10.279Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mmulti-tax-rate[2m > [22m[2mpeppol-bis â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.280Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-MULTITAX-001"}}
{"timestamp":"2026-02-19T15:11:10.280Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mmulti-tax-rate[2m > [22m[2mfacturx-en16931 â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.280Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"EDGE-MULTITAX-001"}}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2malso produces xmlContent with CII XML
[22m[39m{"timestamp":"2026-02-19T15:11:10.283Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/golden-files.test.ts[2m > [22m[2mGolden File Tests[2m > [22m[2mformat: facturx-basic[2m > [22m[2mmatches golden file (or creates it)
[22m[39m{"timestamp":"2026-02-19T15:11:10.283Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-basic","name":"Factur-X Basic"}}
{"timestamp":"2026-02-19T15:11:10.283Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"GOLDEN-2024-001"}}

[90mstdout[2m | tests/unit/cross-format-consistency.test.ts[2m > [22m[2mCross-Format Consistency[2m > [22m[2mFactur-X formats embed XML in PDF
[22m[39m{"timestamp":"2026-02-19T15:11:10.286Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"CONSIST-2024-007"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mmulti-tax-rate[2m > [22m[2mfacturx-basic â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.288Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"EDGE-MULTITAX-001"}}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2membedded XML has correct Factur-X EN16931 SpecificationID
[22m[39m{"timestamp":"2026-02-19T15:11:10.290Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

 [32mâœ“[39m tests/unit/cross-format-consistency.test.ts [2m([22m[2m56 tests[22m[2m)[22m[32m 139[2mms[22m[39m
[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2membedded XML has correct Factur-X BASIC SpecificationID
[22m[39m{"timestamp":"2026-02-19T15:11:10.296Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: facturx-basic[2m > [22m[2mreturns non-empty content
[22m[39m{"timestamp":"2026-02-19T15:11:10.299Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-basic","name":"Factur-X Basic"}}
{"timestamp":"2026-02-19T15:11:10.299Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"CROSS-2024-001"}}

[90mstdout[2m | tests/unit/golden-files.test.ts[2m > [22m[2mGolden File Tests[2m > [22m[2mformat: fatturapa[2m > [22m[2mmatches golden file (or creates it)
[22m[39m{"timestamp":"2026-02-19T15:11:10.298Z","level":"INFO","message":"Format generator created","data":{"format":"fatturapa","name":"FatturaPA 1.2 (Italy)"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mmulti-tax-rate[2m > [22m[2mnlcius â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.302Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-MULTITAX-001"}}
{"timestamp":"2026-02-19T15:11:10.302Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mmulti-tax-rate[2m > [22m[2mcius-ro â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.303Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-MULTITAX-001"}}
{"timestamp":"2026-02-19T15:11:10.303Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/golden-files.test.ts[2m > [22m[2mGolden File Tests[2m > [22m[2mformat: ksef[2m > [22m[2mmatches golden file (or creates it)
[22m[39m{"timestamp":"2026-02-19T15:11:10.302Z","level":"INFO","message":"Format generator created","data":{"format":"ksef","name":"KSeF FA(2) â€” Poland"}}

[90mstdout[2m | tests/unit/golden-files.test.ts[2m > [22m[2mGolden File Tests[2m > [22m[2mformat: nlcius[2m > [22m[2mmatches golden file (or creates it)
[22m[39m{"timestamp":"2026-02-19T15:11:10.305Z","level":"INFO","message":"Format generator created","data":{"format":"nlcius","name":"NLCIUS / SI-UBL 2.0 (Netherlands)"}}
{"timestamp":"2026-02-19T15:11:10.306Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"GOLDEN-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.306Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2mdoes NOT contain XRechnung SpecificationID
[22m[39m{"timestamp":"2026-02-19T15:11:10.310Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: fatturapa[2m > [22m[2mgenerates without throwing
[22m[39m{"timestamp":"2026-02-19T15:11:10.312Z","level":"INFO","message":"Format generator created","data":{"format":"fatturapa","name":"FatturaPA 1.2 (Italy)"}}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: fatturapa[2m > [22m[2mreturns non-empty content
[22m[39m{"timestamp":"2026-02-19T15:11:10.314Z","level":"INFO","message":"Format generator created","data":{"format":"fatturapa","name":"FatturaPA 1.2 (Italy)"}}

[90mstdout[2m | tests/unit/golden-files.test.ts[2m > [22m[2mGolden File Tests[2m > [22m[2mformat: cius-ro[2m > [22m[2mmatches golden file (or creates it)
[22m[39m{"timestamp":"2026-02-19T15:11:10.310Z","level":"INFO","message":"Format generator created","data":{"format":"cius-ro","name":"CIUS-RO (Romania)"}}
{"timestamp":"2026-02-19T15:11:10.310Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"GOLDEN-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.310Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: ksef[2m > [22m[2mgenerates without throwing
[22m[39m{"timestamp":"2026-02-19T15:11:10.314Z","level":"INFO","message":"Format generator created","data":{"format":"ksef","name":"KSeF FA(2) â€” Poland"}}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: ksef[2m > [22m[2mreturns non-empty content
[22m[39m{"timestamp":"2026-02-19T15:11:10.316Z","level":"INFO","message":"Format generator created","data":{"format":"ksef","name":"KSeF FA(2) â€” Poland"}}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: nlcius[2m > [22m[2mgenerates without throwing
[22m[39m{"timestamp":"2026-02-19T15:11:10.316Z","level":"INFO","message":"Format generator created","data":{"format":"nlcius","name":"NLCIUS / SI-UBL 2.0 (Netherlands)"}}
{"timestamp":"2026-02-19T15:11:10.316Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"CROSS-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.316Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: nlcius[2m > [22m[2mreturns non-empty content
[22m[39m{"timestamp":"2026-02-19T15:11:10.317Z","level":"INFO","message":"Format generator created","data":{"format":"nlcius","name":"NLCIUS / SI-UBL 2.0 (Netherlands)"}}
{"timestamp":"2026-02-19T15:11:10.317Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"CROSS-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.317Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

 [32mâœ“[39m tests/unit/golden-files.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 162[2mms[22m[39m
[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: cius-ro[2m > [22m[2mgenerates without throwing
[22m[39m{"timestamp":"2026-02-19T15:11:10.317Z","level":"INFO","message":"Format generator created","data":{"format":"cius-ro","name":"CIUS-RO (Romania)"}}
{"timestamp":"2026-02-19T15:11:10.318Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"CROSS-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.318Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat: cius-ro[2m > [22m[2mreturns non-empty content
[22m[39m{"timestamp":"2026-02-19T15:11:10.318Z","level":"INFO","message":"Format generator created","data":{"format":"cius-ro","name":"CIUS-RO (Romania)"}}
{"timestamp":"2026-02-19T15:11:10.318Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"CROSS-2024-001"}}
{"timestamp":"2026-02-19T15:11:10.318Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mFactur-X formats return pdfContent (Buffer)
[22m[39m{"timestamp":"2026-02-19T15:11:10.319Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-en16931","name":"Factur-X EN 16931 (Comfort)"}}
{"timestamp":"2026-02-19T15:11:10.319Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"CROSS-2024-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mallowances/charges[2m > [22m[2mxrechnung-ubl â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.307Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-ALLOWANCE-001"}}
{"timestamp":"2026-02-19T15:11:10.322Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mallowances/charges[2m > [22m[2mpeppol-bis â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.323Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-ALLOWANCE-001"}}
{"timestamp":"2026-02-19T15:11:10.323Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mallowances/charges[2m > [22m[2mfacturx-en16931 â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.324Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"EDGE-ALLOWANCE-001"}}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mFactur-X formats return pdfContent (Buffer)
[22m[39m{"timestamp":"2026-02-19T15:11:10.326Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-basic","name":"Factur-X Basic"}}
{"timestamp":"2026-02-19T15:11:10.326Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"CROSS-2024-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mallowances/charges[2m > [22m[2mfacturx-basic â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.331Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"EDGE-ALLOWANCE-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mallowances/charges[2m > [22m[2mnlcius â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.340Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-ALLOWANCE-001"}}
{"timestamp":"2026-02-19T15:11:10.340Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mallowances/charges[2m > [22m[2mcius-ro â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.340Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-ALLOWANCE-001"}}
{"timestamp":"2026-02-19T15:11:10.341Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2mincludes standard invoice fields in XML
[22m[39m{"timestamp":"2026-02-19T15:11:10.345Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/cross-format.test.ts[2m > [22m[2mCross-Format Integration[2m > [22m[2mformat switching: generate same invoice in format A then format B
[22m[39m{"timestamp":"2026-02-19T15:11:10.336Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-cii","name":"XRechnung 3.0 (CII)"}}
{"timestamp":"2026-02-19T15:11:10.336Z","level":"INFO","message":"Format generator created","data":{"format":"fatturapa","name":"FatturaPA 1.2 (Italy)"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mminimum viable[2m > [22m[2mxrechnung-ubl â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.346Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-MIN-001"}}
{"timestamp":"2026-02-19T15:11:10.346Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mminimum viable[2m > [22m[2mpeppol-bis â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.347Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-MIN-001"}}
{"timestamp":"2026-02-19T15:11:10.347Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mminimum viable[2m > [22m[2mfacturx-en16931 â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.348Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"EDGE-MIN-001"}}

 [32mâœ“[39m tests/unit/cross-format.test.ts [2m([22m[2m22 tests[22m[2m)[22m[32m 211[2mms[22m[39m
[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mminimum viable[2m > [22m[2mfacturx-basic â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.354Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"EDGE-MIN-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mminimum viable[2m > [22m[2mnlcius â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.361Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-MIN-001"}}
{"timestamp":"2026-02-19T15:11:10.361Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mminimum viable[2m > [22m[2mcius-ro â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.362Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-MIN-001"}}
{"timestamp":"2026-02-19T15:11:10.362Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mmaximum complexity[2m > [22m[2mxrechnung-ubl â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.366Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-MAX-001"}}
{"timestamp":"2026-02-19T15:11:10.366Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mmaximum complexity[2m > [22m[2mpeppol-bis â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.366Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-MAX-001"}}
{"timestamp":"2026-02-19T15:11:10.367Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mmaximum complexity[2m > [22m[2mfacturx-en16931 â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.367Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"EDGE-MAX-001"}}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2mincludes seller and buyer info in XML
[22m[39m{"timestamp":"2026-02-19T15:11:10.371Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mmaximum complexity[2m > [22m[2mfacturx-basic â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.374Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"EDGE-MAX-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mmaximum complexity[2m > [22m[2mnlcius â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.382Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-MAX-001"}}
{"timestamp":"2026-02-19T15:11:10.382Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mmaximum complexity[2m > [22m[2mcius-ro â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.383Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-MAX-001"}}
{"timestamp":"2026-02-19T15:11:10.383Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mnon-EUR currency (GBP)[2m > [22m[2mxrechnung-ubl â€” rejects or handles gracefully
[22m[39m{"timestamp":"2026-02-19T15:11:10.387Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-GBP-001"}}
{"timestamp":"2026-02-19T15:11:10.387Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mnon-EUR currency (GBP)[2m > [22m[2mpeppol-bis â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.387Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-GBP-001"}}
{"timestamp":"2026-02-19T15:11:10.388Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mnon-EUR currency (GBP)[2m > [22m[2mfacturx-en16931 â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.388Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"EDGE-GBP-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mnon-EUR currency (GBP)[2m > [22m[2mfacturx-basic â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.394Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"EDGE-GBP-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mnon-EUR currency (GBP)[2m > [22m[2mnlcius â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.399Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-GBP-001"}}
{"timestamp":"2026-02-19T15:11:10.399Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mnon-EUR currency (GBP)[2m > [22m[2mcius-ro â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.400Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-GBP-001"}}
{"timestamp":"2026-02-19T15:11:10.400Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2mhandles credit notes (TypeCode 381)
[22m[39m{"timestamp":"2026-02-19T15:11:10.400Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mvery long fields[2m > [22m[2mxrechnung-ubl â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.404Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-LONG-001"}}
{"timestamp":"2026-02-19T15:11:10.404Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mvery long fields[2m > [22m[2mpeppol-bis â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.405Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-LONG-001"}}
{"timestamp":"2026-02-19T15:11:10.405Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mvery long fields[2m > [22m[2mfacturx-en16931 â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.405Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"EDGE-LONG-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mvery long fields[2m > [22m[2mfacturx-basic â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.410Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"EDGE-LONG-001"}}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2mhandles non-EUR currency (USD)
[22m[39m{"timestamp":"2026-02-19T15:11:10.426Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2mhandles GBP currency
[22m[39m{"timestamp":"2026-02-19T15:11:10.433Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2mhandles allowances/charges
[22m[39m{"timestamp":"2026-02-19T15:11:10.438Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mvery long fields[2m > [22m[2mnlcius â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.441Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-LONG-001"}}
{"timestamp":"2026-02-19T15:11:10.441Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mvery long fields[2m > [22m[2mcius-ro â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.442Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-LONG-001"}}
{"timestamp":"2026-02-19T15:11:10.442Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2mvisual PDF has at least one page
[22m[39m{"timestamp":"2026-02-19T15:11:10.444Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mspecial characters[2m > [22m[2mxrechnung-ubl â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.445Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-SPECIAL-001"}}
{"timestamp":"2026-02-19T15:11:10.445Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mspecial characters[2m > [22m[2mpeppol-bis â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.445Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-SPECIAL-001"}}
{"timestamp":"2026-02-19T15:11:10.446Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mspecial characters[2m > [22m[2mfacturx-en16931 â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.447Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"EDGE-SPECIAL-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mspecial characters[2m > [22m[2mfacturx-basic â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.453Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"EDGE-SPECIAL-001"}}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFacturXGenerator[2m > [22m[2mvalidate()[2m > [22m[2mpasses for valid Factur-X XML
[22m[39m{"timestamp":"2026-02-19T15:11:10.454Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"FX-2024-001"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mspecial characters[2m > [22m[2mnlcius â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.467Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-SPECIAL-001"}}
{"timestamp":"2026-02-19T15:11:10.468Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mspecial characters[2m > [22m[2mcius-ro â€” generates valid output
[22m[39m{"timestamp":"2026-02-19T15:11:10.468Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-SPECIAL-001"}}
{"timestamp":"2026-02-19T15:11:10.469Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mspecial characters XML safety[2m > [22m[2mxrechnung-ubl â€” XML entities are properly escaped
[22m[39m{"timestamp":"2026-02-19T15:11:10.471Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-SPECIAL-001"}}
{"timestamp":"2026-02-19T15:11:10.471Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mspecial characters XML safety[2m > [22m[2mpeppol-bis â€” XML entities are properly escaped
[22m[39m{"timestamp":"2026-02-19T15:11:10.472Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-SPECIAL-001"}}
{"timestamp":"2026-02-19T15:11:10.472Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mspecial characters XML safety[2m > [22m[2mfacturx-en16931 â€” XML entities are properly escaped
[22m[39m{"timestamp":"2026-02-19T15:11:10.473Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-en16931","invoiceNumber":"EDGE-SPECIAL-001"}}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFactur-X factory registration[2m > [22m[2mGeneratorFactory.create("facturx-en16931") returns FacturXGenerator
[22m[39m{"timestamp":"2026-02-19T15:11:10.474Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-en16931","name":"Factur-X EN 16931 (Comfort)"}}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFactur-X factory registration[2m > [22m[2mGeneratorFactory.create("facturx-basic") returns FacturXGenerator
[22m[39m{"timestamp":"2026-02-19T15:11:10.474Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-basic","name":"Factur-X Basic"}}

[90mstdout[2m | tests/unit/facturx.test.ts[2m > [22m[2mFactur-X factory registration[2m > [22m[2mreturns cached singleton for facturx-en16931
[22m[39m{"timestamp":"2026-02-19T15:11:10.476Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-en16931","name":"Factur-X EN 16931 (Comfort)"}}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mspecial characters XML safety[2m > [22m[2mfacturx-basic â€” XML entities are properly escaped
[22m[39m{"timestamp":"2026-02-19T15:11:10.481Z","level":"INFO","message":"Generating Factur-X invoice","data":{"format":"facturx-basic","invoiceNumber":"EDGE-SPECIAL-001"}}

 [32mâœ“[39m tests/unit/facturx.test.ts [2m([22m[2m38 tests[22m[2m)[22m[33m 327[2mms[22m[39m
[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mspecial characters XML safety[2m > [22m[2mnlcius â€” XML entities are properly escaped
[22m[39m{"timestamp":"2026-02-19T15:11:10.486Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-SPECIAL-001"}}
{"timestamp":"2026-02-19T15:11:10.487Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/edge-cases.test.ts[2m > [22m[2mEdge Cases[2m > [22m[2mspecial characters XML safety[2m > [22m[2mcius-ro â€” XML entities are properly escaped
[22m[39m{"timestamp":"2026-02-19T15:11:10.487Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"EDGE-SPECIAL-001"}}
{"timestamp":"2026-02-19T15:11:10.487Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

 [32mâœ“[39m tests/unit/edge-cases.test.ts [2m([22m[2m90 tests[22m[2m)[22m[33m 334[2mms[22m[39m
 [32mâœ“[39m lib/state-machine/invoice-machine.test.ts [2m([22m[2m33 tests[22m[2m)[22m[32m 25[2mms[22m[39m
 [32mâœ“[39m tests/unit/routes/payments.checkout.route.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 26[2mms[22m[39m
 [32mâœ“[39m tests/unit/file.service.test.ts [2m([22m[2m22 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32mâœ“[39m lib/retention/retention.test.ts [2m([22m[2m26 tests[22m[2m)[22m[32m 25[2mms[22m[39m
 [32mâœ“[39m tests/unit/utils.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 40[2mms[22m[39m
[90mstdout[2m | lib/feature-flags/feature-flags.test.ts[2m > [22m[2mFeatureFlagService[2m > [22m[2msetFlag[2m > [22m[2mupdates flag and invalidates cache
[22m[39m{"timestamp":"2026-02-19T15:11:11.898Z","level":"INFO","message":"Feature flag updated","data":{"flagId":"toggle","enabled":false}}

 [32mâœ“[39m lib/feature-flags/feature-flags.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 32[2mms[22m[39m
 [32mâœ“[39m tests/unit/external-validation.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 25[2mms[22m[39m
 [32mâœ“[39m tests/unit/adapters/supabase.adapter.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 27[2mms[22m[39m
[90mstdout[2m | tests/unit/fatturapa.test.ts[2m > [22m[2mFatturaPA Factory Integration[2m > [22m[2mGeneratorFactory.create("fatturapa") works
[22m[39m{"timestamp":"2026-02-19T15:11:13.420Z","level":"INFO","message":"Format generator created","data":{"format":"fatturapa","name":"FatturaPA 1.2 (Italy)"}}

 [32mâœ“[39m tests/unit/fatturapa.test.ts [2m([22m[2m34 tests[22m[2m)[22m[32m 34[2mms[22m[39m
[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mhappy path[2m > [22m[2mshould complete all steps and return success
[22m[39m{"timestamp":"2026-02-19T15:11:15.084Z","level":"INFO","message":"Saga execution started","data":{"sagaId":"d0595ac6-f6cd-40bc-af56-3d010dac7462","invoiceId":"inv-001","stepCount":3}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mhappy path[2m > [22m[2mshould complete all steps and return success
[22m[39m{"timestamp":"2026-02-19T15:11:15.093Z","level":"INFO","message":"Saga step completed","data":{"sagaId":"d0595ac6-f6cd-40bc-af56-3d010dac7462","step":"validate"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mhappy path[2m > [22m[2mshould complete all steps and return success
[22m[39m{"timestamp":"2026-02-19T15:11:15.093Z","level":"INFO","message":"Saga step completed","data":{"sagaId":"d0595ac6-f6cd-40bc-af56-3d010dac7462","step":"deduct"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mhappy path[2m > [22m[2mshould complete all steps and return success
[22m[39m{"timestamp":"2026-02-19T15:11:15.094Z","level":"INFO","message":"Saga step completed","data":{"sagaId":"d0595ac6-f6cd-40bc-af56-3d010dac7462","step":"extract"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mhappy path[2m > [22m[2mshould complete all steps and return success
[22m[39m{"timestamp":"2026-02-19T15:11:15.094Z","level":"INFO","message":"Saga execution completed","data":{"sagaId":"d0595ac6-f6cd-40bc-af56-3d010dac7462","result":{"success":true,"completedSteps":["validate","deduct","extract"],"compensatedSteps":[]}}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mhappy path[2m > [22m[2mshould pass shared context through all steps
[22m[39m{"timestamp":"2026-02-19T15:11:15.096Z","level":"INFO","message":"Saga execution started","data":{"sagaId":"a007c516-bcb1-443e-a5fb-42027dd4d268","invoiceId":"inv-001","stepCount":2}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mhappy path[2m > [22m[2mshould pass shared context through all steps
[22m[39m{"timestamp":"2026-02-19T15:11:15.096Z","level":"INFO","message":"Saga step completed","data":{"sagaId":"a007c516-bcb1-443e-a5fb-42027dd4d268","step":"setExtraction"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mhappy path[2m > [22m[2mshould pass shared context through all steps
[22m[39m{"timestamp":"2026-02-19T15:11:15.096Z","level":"INFO","message":"Saga step completed","data":{"sagaId":"a007c516-bcb1-443e-a5fb-42027dd4d268","step":"checkExtraction"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mhappy path[2m > [22m[2mshould pass shared context through all steps
[22m[39m{"timestamp":"2026-02-19T15:11:15.097Z","level":"INFO","message":"Saga execution completed","data":{"sagaId":"a007c516-bcb1-443e-a5fb-42027dd4d268","result":{"success":true,"completedSteps":["setExtraction","checkExtraction"],"compensatedSteps":[]}}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mfailure with compensation[2m > [22m[2mshould compensate completed steps in reverse order on failure
[22m[39m{"timestamp":"2026-02-19T15:11:15.098Z","level":"INFO","message":"Saga execution started","data":{"sagaId":"d7c57bbf-9a6a-43d2-a628-093adf11c297","invoiceId":"inv-001","stepCount":3}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mfailure with compensation[2m > [22m[2mshould compensate completed steps in reverse order on failure
[22m[39m{"timestamp":"2026-02-19T15:11:15.098Z","level":"INFO","message":"Saga step completed","data":{"sagaId":"d7c57bbf-9a6a-43d2-a628-093adf11c297","step":"validate"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mfailure with compensation[2m > [22m[2mshould compensate completed steps in reverse order on failure
[22m[39m{"timestamp":"2026-02-19T15:11:15.098Z","level":"INFO","message":"Saga step completed","data":{"sagaId":"d7c57bbf-9a6a-43d2-a628-093adf11c297","step":"deduct"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mfailure with compensation[2m > [22m[2mshould compensate completed steps in reverse order on failure
[22m[39m{"timestamp":"2026-02-19T15:11:15.099Z","level":"INFO","message":"Saga compensation completed","data":{"sagaId":"d7c57bbf-9a6a-43d2-a628-093adf11c297","step":"deduct"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mfailure with compensation[2m > [22m[2mshould compensate completed steps in reverse order on failure
[22m[39m{"timestamp":"2026-02-19T15:11:15.099Z","level":"INFO","message":"Saga compensation completed","data":{"sagaId":"d7c57bbf-9a6a-43d2-a628-093adf11c297","step":"validate"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mfailure with compensation[2m > [22m[2mshould compensate completed steps in reverse order on failure
[22m[39m{"timestamp":"2026-02-19T15:11:15.099Z","level":"INFO","message":"Saga execution failed","data":{"sagaId":"d7c57bbf-9a6a-43d2-a628-093adf11c297","result":{"success":false,"completedSteps":["validate","deduct"],"failedStep":"extract","compensatedSteps":["deduct","validate"]}}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mfailure with compensation[2m > [22m[2mshould set error on context when a step fails
[22m[39m{"timestamp":"2026-02-19T15:11:15.100Z","level":"INFO","message":"Saga execution started","data":{"sagaId":"818305fd-68a9-4b3b-8eb5-de1eb7be35e6","invoiceId":"inv-001","stepCount":2}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mfailure with compensation[2m > [22m[2mshould set error on context when a step fails
[22m[39m{"timestamp":"2026-02-19T15:11:15.100Z","level":"INFO","message":"Saga step completed","data":{"sagaId":"818305fd-68a9-4b3b-8eb5-de1eb7be35e6","step":"validate"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mfailure with compensation[2m > [22m[2mshould set error on context when a step fails
[22m[39m{"timestamp":"2026-02-19T15:11:15.101Z","level":"INFO","message":"Saga compensation completed","data":{"sagaId":"818305fd-68a9-4b3b-8eb5-de1eb7be35e6","step":"validate"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mfailure with compensation[2m > [22m[2mshould set error on context when a step fails
[22m[39m{"timestamp":"2026-02-19T15:11:15.101Z","level":"INFO","message":"Saga execution failed","data":{"sagaId":"818305fd-68a9-4b3b-8eb5-de1eb7be35e6","result":{"success":false,"completedSteps":["validate"],"failedStep":"failStep","compensatedSteps":["validate"]}}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mfailure with compensation[2m > [22m[2mshould not compensate any steps when the first step fails
[22m[39m{"timestamp":"2026-02-19T15:11:15.101Z","level":"INFO","message":"Saga execution started","data":{"sagaId":"2e9e364b-5084-4a6c-b98c-d8987b313f27","invoiceId":"inv-001","stepCount":2}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mfailure with compensation[2m > [22m[2mshould not compensate any steps when the first step fails
[22m[39m{"timestamp":"2026-02-19T15:11:15.102Z","level":"INFO","message":"Saga execution failed","data":{"sagaId":"2e9e364b-5084-4a6c-b98c-d8987b313f27","result":{"success":false,"completedSteps":[],"failedStep":"validate","compensatedSteps":[]}}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mpartial compensation on double failure[2m > [22m[2mshould continue compensating remaining steps even if one compensation fails
[22m[39m{"timestamp":"2026-02-19T15:11:15.102Z","level":"INFO","message":"Saga execution started","data":{"sagaId":"0ccb4c44-1ac8-41b0-8b67-b9ccdcbd448e","invoiceId":"inv-001","stepCount":4}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mpartial compensation on double failure[2m > [22m[2mshould continue compensating remaining steps even if one compensation fails
[22m[39m{"timestamp":"2026-02-19T15:11:15.103Z","level":"INFO","message":"Saga step completed","data":{"sagaId":"0ccb4c44-1ac8-41b0-8b67-b9ccdcbd448e","step":"validate"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mpartial compensation on double failure[2m > [22m[2mshould continue compensating remaining steps even if one compensation fails
[22m[39m{"timestamp":"2026-02-19T15:11:15.103Z","level":"INFO","message":"Saga step completed","data":{"sagaId":"0ccb4c44-1ac8-41b0-8b67-b9ccdcbd448e","step":"deduct"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mpartial compensation on double failure[2m > [22m[2mshould continue compensating remaining steps even if one compensation fails
[22m[39m{"timestamp":"2026-02-19T15:11:15.103Z","level":"INFO","message":"Saga step completed","data":{"sagaId":"0ccb4c44-1ac8-41b0-8b67-b9ccdcbd448e","step":"extract"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mpartial compensation on double failure[2m > [22m[2mshould continue compensating remaining steps even if one compensation fails
[22m[39m{"timestamp":"2026-02-19T15:11:15.103Z","level":"INFO","message":"Saga compensation completed","data":{"sagaId":"0ccb4c44-1ac8-41b0-8b67-b9ccdcbd448e","step":"extract"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mpartial compensation on double failure[2m > [22m[2mshould continue compensating remaining steps even if one compensation fails
[22m[39m{"timestamp":"2026-02-19T15:11:15.104Z","level":"INFO","message":"Saga compensation completed","data":{"sagaId":"0ccb4c44-1ac8-41b0-8b67-b9ccdcbd448e","step":"validate"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mpartial compensation on double failure[2m > [22m[2mshould continue compensating remaining steps even if one compensation fails
[22m[39m{"timestamp":"2026-02-19T15:11:15.104Z","level":"INFO","message":"Saga execution failed","data":{"sagaId":"0ccb4c44-1ac8-41b0-8b67-b9ccdcbd448e","result":{"success":false,"completedSteps":["validate","deduct","extract"],"failedStep":"convert","compensatedSteps":["extract","validate"]}}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mlog writer[2m > [22m[2mshould call log writer for each step execution
[22m[39m{"timestamp":"2026-02-19T15:11:15.105Z","level":"INFO","message":"Saga execution started","data":{"sagaId":"3610784a-7246-4bdb-965b-14fc38fafa84","invoiceId":"inv-001","stepCount":2}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mlog writer[2m > [22m[2mshould call log writer for each step execution
[22m[39m{"timestamp":"2026-02-19T15:11:15.105Z","level":"INFO","message":"Saga step completed","data":{"sagaId":"3610784a-7246-4bdb-965b-14fc38fafa84","step":"validate"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mlog writer[2m > [22m[2mshould call log writer for each step execution
[22m[39m{"timestamp":"2026-02-19T15:11:15.105Z","level":"INFO","message":"Saga step completed","data":{"sagaId":"3610784a-7246-4bdb-965b-14fc38fafa84","step":"deduct"}}

[90mstdout[2m | lib/saga/orchestrator.test.ts[2m > [22m[2mSagaOrchestrator[2m > [22m[2mlog writer[2m > [22m[2mshould call log writer for each step execution
[22m[39m{"timestamp":"2026-02-19T15:11:15.105Z","level":"INFO","message":"Saga execution completed","data":{"sagaId":"3610784a-7246-4bdb-965b-14fc38fafa84","result":{"success":true,"completedSteps":["validate","deduct"],"compensatedSteps":[]}}}

 [32mâœ“[39m lib/saga/orchestrator.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 32[2mms[22m[39m
 [32mâœ“[39m lib/metrics.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 25[2mms[22m[39m
[90mstdout[2m | tests/unit/round-trip.test.ts[2m > [22m[2mRound-Trip Validation[2m > [22m[2mformat: xrechnung-cii
[22m[39m{"timestamp":"2026-02-19T15:11:15.359Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-cii","name":"XRechnung 3.0 (CII)"}}

[90mstdout[2m | tests/unit/round-trip.test.ts[2m > [22m[2mRound-Trip Validation[2m > [22m[2mformat: xrechnung-ubl
[22m[39m{"timestamp":"2026-02-19T15:11:15.375Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-ubl","name":"XRechnung 3.0 (UBL)"}}
{"timestamp":"2026-02-19T15:11:15.375Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"RT-2024-042"}}
{"timestamp":"2026-02-19T15:11:15.376Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/round-trip.test.ts[2m > [22m[2mRound-Trip Validation[2m > [22m[2mformat: peppol-bis
[22m[39m{"timestamp":"2026-02-19T15:11:15.378Z","level":"INFO","message":"Format generator created","data":{"format":"peppol-bis","name":"PEPPOL BIS Billing 3.0"}}
{"timestamp":"2026-02-19T15:11:15.378Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"RT-2024-042"}}
{"timestamp":"2026-02-19T15:11:15.378Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/round-trip.test.ts[2m > [22m[2mRound-Trip Validation[2m > [22m[2mformat: fatturapa
[22m[39m{"timestamp":"2026-02-19T15:11:15.379Z","level":"INFO","message":"Format generator created","data":{"format":"fatturapa","name":"FatturaPA 1.2 (Italy)"}}

[90mstdout[2m | tests/unit/round-trip.test.ts[2m > [22m[2mRound-Trip Validation[2m > [22m[2mformat: ksef
[22m[39m{"timestamp":"2026-02-19T15:11:15.382Z","level":"INFO","message":"Format generator created","data":{"format":"ksef","name":"KSeF FA(2) â€” Poland"}}

 [32mâœ“[39m tests/unit/round-trip.test.ts [2m([22m[2m35 tests[22m[2m)[22m[32m 27[2mms[22m[39m
 [32mâœ“[39m tests/unit/routes/auth.logout.route.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 24[2mms[22m[39m
 [32mâœ“[39m tests/unit/ai-sanitization.test.ts [2m([22m[2m40 tests[22m[2m)[22m[32m 28[2mms[22m[39m
[90mstdout[2m | tests/unit/ksef.test.ts[2m > [22m[2mKSeF Factory Integration[2m > [22m[2mshould create ksef generator via factory
[22m[39m{"timestamp":"2026-02-19T15:11:16.000Z","level":"INFO","message":"Format generator created","data":{"format":"ksef","name":"KSeF FA(2) â€” Poland"}}

 [32mâœ“[39m tests/unit/ksef.test.ts [2m([22m[2m39 tests[22m[2m)[22m[32m 25[2mms[22m[39m
 [32mâœ“[39m tests/unit/routes/admin.user.detail.route.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 23[2mms[22m[39m
[90mstdout[2m | tests/unit/adapters/stripe.adapter.test.ts[2m > [22m[2mStripeAdapter[2m > [22m[2mshould construct webhook event verification
[22m[39m{"timestamp":"2026-02-19T15:11:16.094Z","level":"INFO","message":"Stripe webhook signature verified successfully"}

[90mstdout[2m | tests/unit/adapters/stripe.adapter.test.ts[2m > [22m[2mStripeAdapter[2m > [22m[2mshould refund payment
[22m[39m{"timestamp":"2026-02-19T15:11:16.102Z","level":"INFO","message":"Stripe refund successful","data":{"refundId":"re_123","paymentIntentId":"pi_123","amount":1000,"status":"succeeded"}}

 [32mâœ“[39m tests/unit/adapters/stripe.adapter.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 24[2mms[22m[39m
[90mstdout[2m | tests/unit/payment-processor.test.ts[2m > [22m[2mPaymentProcessor[2m > [22m[2mprocessPayment throws for invalid package
[22m[39m{"timestamp":"2026-02-19T15:11:16.673Z","level":"INFO","message":"Processing payment","data":{"method":"stripe","userId":"user-1","packageId":"invalid_pkg"}}

[90mstdout[2m | tests/unit/payment-processor.test.ts[2m > [22m[2mPaymentProcessor[2m > [22m[2mprocessPayment creates stripe session when configured
[22m[39m{"timestamp":"2026-02-19T15:11:16.681Z","level":"INFO","message":"Processing payment","data":{"method":"stripe","userId":"user-1","packageId":"basic_10"}}

[90mstdout[2m | tests/unit/payment-processor.test.ts[2m > [22m[2mPaymentProcessor[2m > [22m[2mhandleStripeWebhook returns already processed when event exists
[22m[39m{"timestamp":"2026-02-19T15:11:16.683Z","level":"INFO","message":"Handling Stripe webhook","data":{"type":"checkout.session.completed","eventId":"evt_1"}}

[90mstdout[2m | tests/unit/payment-processor.test.ts[2m > [22m[2mPaymentProcessor[2m > [22m[2mhandleStripeWebhook returns already processed when event exists
[22m[39m{"timestamp":"2026-02-19T15:11:16.684Z","level":"INFO","message":"Webhook already processed, skipping","data":{"eventId":"evt_1"}}

 [32mâœ“[39m tests/unit/payment-processor.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 13[2mms[22m[39m
[90mstdout[2m | tests/unit/peppol-v3020.test.ts[2m > [22m[2mPeppol BIS Billing 3.0 v3.0.20 compliance[2m > [22m[2mGenerated XML â€” canonical identifiers[2m > [22m[2mcontains the PEPPOL BIS 3.0 CustomizationID
[22m[39m{"timestamp":"2026-02-19T15:11:16.736Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"TEST-PEPPOL-3020"}}
{"timestamp":"2026-02-19T15:11:16.742Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-v3020.test.ts[2m > [22m[2mPeppol BIS Billing 3.0 v3.0.20 compliance[2m > [22m[2mGenerated XML â€” canonical identifiers[2m > [22m[2mcontains the PEPPOL BIS 3.0 ProfileID
[22m[39m{"timestamp":"2026-02-19T15:11:16.744Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"TEST-PEPPOL-3020"}}
{"timestamp":"2026-02-19T15:11:16.744Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-v3020.test.ts[2m > [22m[2mPeppol BIS Billing 3.0 v3.0.20 compliance[2m > [22m[2mGenerated XML â€” canonical identifiers[2m > [22m[2mcontains EndpointID for seller (BT-34)
[22m[39m{"timestamp":"2026-02-19T15:11:16.744Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"TEST-PEPPOL-3020"}}
{"timestamp":"2026-02-19T15:11:16.744Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/peppol-v3020.test.ts[2m > [22m[2mPeppol BIS Billing 3.0 v3.0.20 compliance[2m > [22m[2mAll generators implement specVersion and specDate[2m > [22m[2mxrechnung-cii has a non-empty specVersion and specDate
[22m[39m{"timestamp":"2026-02-19T15:11:16.748Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-cii","name":"XRechnung 3.0 (CII)"}}

[90mstdout[2m | tests/unit/peppol-v3020.test.ts[2m > [22m[2mPeppol BIS Billing 3.0 v3.0.20 compliance[2m > [22m[2mAll generators implement specVersion and specDate[2m > [22m[2mxrechnung-ubl has a non-empty specVersion and specDate
[22m[39m{"timestamp":"2026-02-19T15:11:16.749Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-ubl","name":"XRechnung 3.0 (UBL)"}}

[90mstdout[2m | tests/unit/peppol-v3020.test.ts[2m > [22m[2mPeppol BIS Billing 3.0 v3.0.20 compliance[2m > [22m[2mAll generators implement specVersion and specDate[2m > [22m[2mpeppol-bis has a non-empty specVersion and specDate
[22m[39m{"timestamp":"2026-02-19T15:11:16.749Z","level":"INFO","message":"Format generator created","data":{"format":"peppol-bis","name":"PEPPOL BIS Billing 3.0"}}

[90mstdout[2m | tests/unit/peppol-v3020.test.ts[2m > [22m[2mPeppol BIS Billing 3.0 v3.0.20 compliance[2m > [22m[2mAll generators implement specVersion and specDate[2m > [22m[2mfacturx-en16931 has a non-empty specVersion and specDate
[22m[39m{"timestamp":"2026-02-19T15:11:16.750Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-en16931","name":"Factur-X EN 16931 (Comfort)"}}

[90mstdout[2m | tests/unit/peppol-v3020.test.ts[2m > [22m[2mPeppol BIS Billing 3.0 v3.0.20 compliance[2m > [22m[2mAll generators implement specVersion and specDate[2m > [22m[2mfacturx-basic has a non-empty specVersion and specDate
[22m[39m{"timestamp":"2026-02-19T15:11:16.750Z","level":"INFO","message":"Format generator created","data":{"format":"facturx-basic","name":"Factur-X Basic"}}

[90mstdout[2m | tests/unit/peppol-v3020.test.ts[2m > [22m[2mPeppol BIS Billing 3.0 v3.0.20 compliance[2m > [22m[2mAll generators implement specVersion and specDate[2m > [22m[2mfatturapa has a non-empty specVersion and specDate
[22m[39m{"timestamp":"2026-02-19T15:11:16.751Z","level":"INFO","message":"Format generator created","data":{"format":"fatturapa","name":"FatturaPA 1.2 (Italy)"}}

[90mstdout[2m | tests/unit/peppol-v3020.test.ts[2m > [22m[2mPeppol BIS Billing 3.0 v3.0.20 compliance[2m > [22m[2mAll generators implement specVersion and specDate[2m > [22m[2mksef has a non-empty specVersion and specDate
[22m[39m{"timestamp":"2026-02-19T15:11:16.751Z","level":"INFO","message":"Format generator created","data":{"format":"ksef","name":"KSeF FA(2) â€” Poland"}}

[90mstdout[2m | tests/unit/peppol-v3020.test.ts[2m > [22m[2mPeppol BIS Billing 3.0 v3.0.20 compliance[2m > [22m[2mAll generators implement specVersion and specDate[2m > [22m[2mnlcius has a non-empty specVersion and specDate
[22m[39m{"timestamp":"2026-02-19T15:11:16.751Z","level":"INFO","message":"Format generator created","data":{"format":"nlcius","name":"NLCIUS / SI-UBL 2.0 (Netherlands)"}}

[90mstdout[2m | tests/unit/peppol-v3020.test.ts[2m > [22m[2mPeppol BIS Billing 3.0 v3.0.20 compliance[2m > [22m[2mAll generators implement specVersion and specDate[2m > [22m[2mcius-ro has a non-empty specVersion and specDate
[22m[39m{"timestamp":"2026-02-19T15:11:16.752Z","level":"INFO","message":"Format generator created","data":{"format":"cius-ro","name":"CIUS-RO (Romania)"}}

 [32mâœ“[39m tests/unit/peppol-v3020.test.ts [2m([22m[2m23 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32mâœ“[39m tests/unit/routes/auth.me.route.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32mâœ“[39m tests/unit/xml-utils.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 19[2mms[22m[39m
[90mstdout[2m | tests/unit/nlcius.test.ts[2m > [22m[2mNLCIUSGenerator[2m > [22m[2mshould generate XML with NLCIUS customization ID
[22m[39m{"timestamp":"2026-02-19T15:11:17.086Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"NL-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.092Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/nlcius.test.ts[2m > [22m[2mNLCIUSGenerator[2m > [22m[2mshould NOT contain PEPPOL customization ID
[22m[39m{"timestamp":"2026-02-19T15:11:17.093Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"NL-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.093Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/nlcius.test.ts[2m > [22m[2mNLCIUSGenerator[2m > [22m[2mshould generate valid UBL XML structure
[22m[39m{"timestamp":"2026-02-19T15:11:17.094Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"NL-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.094Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/nlcius.test.ts[2m > [22m[2mNLCIUSGenerator[2m > [22m[2mshould produce _nlcius file name
[22m[39m{"timestamp":"2026-02-19T15:11:17.095Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"NL-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.095Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/nlcius.test.ts[2m > [22m[2mNLCIUSGenerator[2m > [22m[2mshould set fileSize correctly
[22m[39m{"timestamp":"2026-02-19T15:11:17.095Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"NL-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.095Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/nlcius.test.ts[2m > [22m[2mNLCIUS Additional Coverage[2m > [22m[2mhandles credit note (documentTypeCode 381)
[22m[39m{"timestamp":"2026-02-19T15:11:17.100Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"NL-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.100Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/nlcius.test.ts[2m > [22m[2mNLCIUS Additional Coverage[2m > [22m[2mhandles non-EUR currency (USD)
[22m[39m{"timestamp":"2026-02-19T15:11:17.100Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"NL-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.101Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/nlcius.test.ts[2m > [22m[2mNLCIUS Additional Coverage[2m > [22m[2mhandles missing endpoint IDs without crashing
[22m[39m{"timestamp":"2026-02-19T15:11:17.101Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"NL-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.101Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/nlcius.test.ts[2m > [22m[2mNLCIUS Factory Registration[2m > [22m[2mshould be available via GeneratorFactory
[22m[39m{"timestamp":"2026-02-19T15:11:17.102Z","level":"INFO","message":"Format generator created","data":{"format":"nlcius","name":"NLCIUS / SI-UBL 2.0 (Netherlands)"}}

 [32mâœ“[39m tests/unit/nlcius.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 20[2mms[22m[39m
[90mstdout[2m | tests/unit/ciusro.test.ts[2m > [22m[2mCIUSROGenerator[2m > [22m[2mshould generate XML with CIUS-RO customization ID
[22m[39m{"timestamp":"2026-02-19T15:11:17.878Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"RO-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.885Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/ciusro.test.ts[2m > [22m[2mCIUSROGenerator[2m > [22m[2mshould NOT contain PEPPOL customization ID
[22m[39m{"timestamp":"2026-02-19T15:11:17.887Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"RO-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.887Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/ciusro.test.ts[2m > [22m[2mCIUSROGenerator[2m > [22m[2mshould produce _ciusro file name
[22m[39m{"timestamp":"2026-02-19T15:11:17.888Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"RO-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.888Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/ciusro.test.ts[2m > [22m[2mCIUS-RO Additional Coverage[2m > [22m[2mhandles credit note (documentTypeCode 381)
[22m[39m{"timestamp":"2026-02-19T15:11:17.892Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"RO-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.893Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/ciusro.test.ts[2m > [22m[2mCIUS-RO Additional Coverage[2m > [22m[2mhandles non-RON currency (EUR)
[22m[39m{"timestamp":"2026-02-19T15:11:17.893Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"RO-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.893Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/ciusro.test.ts[2m > [22m[2mCIUS-RO Additional Coverage[2m > [22m[2mhandles missing endpoint IDs without crashing
[22m[39m{"timestamp":"2026-02-19T15:11:17.894Z","level":"INFO","message":"Generating UBL 2.1 XRechnung invoice","data":{"invoiceNumber":"RO-2024-001"}}
{"timestamp":"2026-02-19T15:11:17.894Z","level":"INFO","message":"UBL XRechnung invoice generated successfully"}

[90mstdout[2m | tests/unit/ciusro.test.ts[2m > [22m[2mCIUS-RO Factory Registration[2m > [22m[2mshould be available via GeneratorFactory
[22m[39m{"timestamp":"2026-02-19T15:11:17.895Z","level":"INFO","message":"Format generator created","data":{"format":"cius-ro","name":"CIUS-RO (Romania)"}}

 [32mâœ“[39m tests/unit/ciusro.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 22[2mms[22m[39m
 [32mâœ“[39m lib/container/container.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 30[2mms[22m[39m
 [32mâœ“[39m lib/xml-security.test.ts [2m([22m[2m28 tests[22m[2m)[22m[32m 18[2mms[22m[39m
 [32mâœ“[39m lib/rbac/rbac.test.ts [2m([22m[2m26 tests[22m[2m)[22m[32m 19[2mms[22m[39m
 [32mâœ“[39m tests/unit/adapters/sendgrid.adapter.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 26[2mms[22m[39m
[90mstdout[2m | tests/unit/adapters/gemini.adapter.test.ts[2m > [22m[2mGeminiAdapter[2m > [22m[2mshould extract invoice data successfully
[22m[39m{"timestamp":"2026-02-19T15:11:20.105Z","level":"INFO","message":"Gemini extraction started","data":{"mimeType":"application/pdf","bufferSize":4}}

[90mstdout[2m | tests/unit/adapters/gemini.adapter.test.ts[2m > [22m[2mGeminiAdapter[2m > [22m[2mshould extract invoice data successfully
[22m[39m{"timestamp":"2026-02-19T15:11:20.112Z","level":"INFO","message":"Gemini extraction successful","data":{"processingTimeMs":7,"confidence":0.7}}

[90mstdout[2m | tests/unit/adapters/gemini.adapter.test.ts[2m > [22m[2mGeminiAdapter[2m > [22m[2mshould handle invalid JSON response
[22m[39m{"timestamp":"2026-02-19T15:11:20.113Z","level":"INFO","message":"Gemini extraction started","data":{"mimeType":"application/pdf","bufferSize":4}}

[90mstdout[2m | tests/unit/adapters/gemini.adapter.test.ts[2m > [22m[2mGeminiAdapter[2m > [22m[2mshould handle API errors
[22m[39m{"timestamp":"2026-02-19T15:11:20.115Z","level":"INFO","message":"Gemini extraction started","data":{"mimeType":"application/pdf","bufferSize":4}}

 [32mâœ“[39m tests/unit/adapters/gemini.adapter.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 17[2mms[22m[39m
[90mstdout[2m | tests/unit/adapters/openai.adapter.test.ts[2m > [22m[2mOpenAIAdapter[2m > [22m[2mshould extract invoice data successfully
[22m[39m{"timestamp":"2026-02-19T15:11:20.542Z","level":"INFO","message":"OpenAI extraction started","data":{"mimeType":"application/pdf","bufferSize":4}}

[90mstdout[2m | tests/unit/adapters/openai.adapter.test.ts[2m > [22m[2mOpenAIAdapter[2m > [22m[2mshould extract invoice data successfully
[22m[39m{"timestamp":"2026-02-19T15:11:20.549Z","level":"INFO","message":"OpenAI extraction successful","data":{"processingTimeMs":7,"confidence":0.7}}

[90mstdout[2m | tests/unit/adapters/openai.adapter.test.ts[2m > [22m[2mOpenAIAdapter[2m > [22m[2mshould handle API timeouts
[22m[39m{"timestamp":"2026-02-19T15:11:20.552Z","level":"INFO","message":"OpenAI extraction started","data":{"mimeType":"application/pdf","bufferSize":4}}

[90mstdout[2m | tests/unit/adapters/openai.adapter.test.ts[2m > [22m[2mOpenAIAdapter[2m > [22m[2mshould handle invalid JSON response
[22m[39m{"timestamp":"2026-02-19T15:11:20.555Z","level":"INFO","message":"OpenAI extraction started","data":{"mimeType":"application/pdf","bufferSize":4}}

 [32mâœ“[39m tests/unit/adapters/openai.adapter.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 18[2mms[22m[39m
 [32mâœ“[39m lib/outbox/outbox.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 15[2mms[22m[39m
[90mstdout[2m | tests/unit/GeneratorFactory.test.ts[2m > [22m[2mGeneratorFactory[2m > [22m[2mcreates xrechnung-cii generator
[22m[39m{"timestamp":"2026-02-19T15:11:21.311Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-cii","name":"XRechnung 3.0 (CII)"}}

[90mstdout[2m | tests/unit/GeneratorFactory.test.ts[2m > [22m[2mGeneratorFactory[2m > [22m[2mcreates xrechnung-ubl generator
[22m[39m{"timestamp":"2026-02-19T15:11:21.316Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-ubl","name":"XRechnung 3.0 (UBL)"}}

[90mstdout[2m | tests/unit/GeneratorFactory.test.ts[2m > [22m[2mGeneratorFactory[2m > [22m[2mreturns cached singleton instances
[22m[39m{"timestamp":"2026-02-19T15:11:21.317Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-cii","name":"XRechnung 3.0 (CII)"}}

[90mstdout[2m | tests/unit/GeneratorFactory.test.ts[2m > [22m[2mGeneratorFactory[2m > [22m[2mreturns different instances for different formats
[22m[39m{"timestamp":"2026-02-19T15:11:21.317Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-cii","name":"XRechnung 3.0 (CII)"}}
{"timestamp":"2026-02-19T15:11:21.317Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-ubl","name":"XRechnung 3.0 (UBL)"}}

[90mstdout[2m | tests/unit/GeneratorFactory.test.ts[2m > [22m[2mGeneratorFactory[2m > [22m[2mcreates fatturapa generator
[22m[39m{"timestamp":"2026-02-19T15:11:21.318Z","level":"INFO","message":"Format generator created","data":{"format":"fatturapa","name":"FatturaPA 1.2 (Italy)"}}

[90mstdout[2m | tests/unit/GeneratorFactory.test.ts[2m > [22m[2mGeneratorFactory[2m > [22m[2mclear resets the cache
[22m[39m{"timestamp":"2026-02-19T15:11:21.320Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-cii","name":"XRechnung 3.0 (CII)"}}
{"timestamp":"2026-02-19T15:11:21.320Z","level":"INFO","message":"Format generator created","data":{"format":"xrechnung-cii","name":"XRechnung 3.0 (CII)"}}

 [32mâœ“[39m tests/unit/GeneratorFactory.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m tests/unit/review.service.test.ts [2m([22m[2m38 tests[22m[2m)[22m[32m 15[2mms[22m[39m
[90mstdout[2m | tests/unit/lib/pdf-text-extractor.test.ts[2m > [22m[2mextractTextFromPdf[2m > [22m[2mreturns hasText: true for digital PDFs with sufficient text
[22m[39m{"timestamp":"2026-02-19T15:11:21.422Z","level":"INFO","message":"PDF text extraction complete","data":{"pageCount":1,"textLength":200,"avgCharsPerPage":200,"hasText":true}}

[90mstdout[2m | tests/unit/lib/pdf-text-extractor.test.ts[2m > [22m[2mextractTextFromPdf[2m > [22m[2mjoins multiple pages with double newline
[22m[39m{"timestamp":"2026-02-19T15:11:21.429Z","level":"INFO","message":"PDF text extraction complete","data":{"pageCount":2,"textLength":202,"avgCharsPerPage":101,"hasText":true}}

[90mstdout[2m | tests/unit/lib/pdf-text-extractor.test.ts[2m > [22m[2mextractTextFromPdf[2m > [22m[2mreturns hasText: false for scanned PDFs with little text
[22m[39m{"timestamp":"2026-02-19T15:11:21.430Z","level":"INFO","message":"PDF text extraction complete","data":{"pageCount":1,"textLength":2,"avgCharsPerPage":2,"hasText":false}}

 [32mâœ“[39m tests/unit/lib/pdf-text-extractor.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m lib/encryption/envelope.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m tests/unit/boundary-detection.service.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m tests/unit/routes/health.route.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m tests/unit/validation-pipeline.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m tests/unit/readiness-panel-logic.test.ts [2m([22m[2m29 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m tests/unit/routes/packages.route.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m tests/unit/auth.service.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/extraction-normalizer-prompt-contract.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/extraction-normalizer-safe-number.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/api-helpers.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/api-throttle.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/utils.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/monetary-validator.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m lib/circuit-breaker.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/handleApiError.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m tests/unit/canonical-mapper.test.ts [2m([22m[2m19 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/extraction-normalizer-en16931.test.ts [2m([22m[2m29 tests[22m[2m)[22m[32m 12[2mms[22m[39m
[90mstdout[2m | tests/unit/lib/extraction-normalizer-taxrate-array.test.ts[2m > [22m[2mextraction-normalizer: taxRate array handling[2m > [22m[2mshould convert line item taxRate array to undefined
[22m[39m{"timestamp":"2026-02-19T15:11:26.997Z","level":"INFO","message":"Gross pricing detected â€” converting line items and allowances to NET","data":{"lineTotal":100,"totalAmount":100,"taxAmount":100}}

[90mstdout[2m | tests/unit/lib/extraction-normalizer-taxrate-array.test.ts[2m > [22m[2mextraction-normalizer: taxRate array handling[2m > [22m[2mshould preserve normal line item taxRate
[22m[39m{"timestamp":"2026-02-19T15:11:27.004Z","level":"INFO","message":"Gross pricing detected â€” converting line items and allowances to NET","data":{"lineTotal":100,"totalAmount":100,"taxAmount":100}}

 [32mâœ“[39m tests/unit/lib/extraction-normalizer-taxrate-array.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/unit/ai/extractors.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/ocr-extractor.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m tests/unit/queue/workers-shutdown.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/session.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m tests/unit/admin/transaction.admin.service.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m tests/unit/ai/mistral.extractor.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m tests/unit/batch/credit-idempotency.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m tests/unit/format-registry.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m tests/unit/adapters/paypal.adapter.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 9[2mms[22m[39m
[90mstdout[2m | tests/unit/lib/rate-limiter.test.ts
[22m[39m{"timestamp":"2026-02-19T15:11:31.041Z","level":"INFO","message":"Redis not configured, using in-memory rate limiter (development only)"}

 [32mâœ“[39m tests/unit/lib/rate-limiter.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/unit/batch-format-validation.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m tests/unit/invoice-review-payload.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m tests/unit/format-readiness.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/extraction-validator.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m tests/unit/queue/dead-letter-wiring.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/monetary.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/unit/extraction/extraction-prompt.contract.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m tests/unit/facturx-profile-mapping-integration.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/unit/gemini.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/validators.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m tests/unit/database.service.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/unit/database-helpers.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/errors.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/cors.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m tests/unit/validation/monetary-validator.net-gross.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m tests/unit/credits/credit-concurrency.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/text-extraction.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/extraction-retry.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/format-utils.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m tests/unit/lib/validation-error-propagation.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 5[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m97 passed[39m[22m[90m (98)[39m
[2m      Tests [22m [1m[32m1506 passed[39m[22m[90m (1506)[39m
[2m   Start at [22m 16:10:58
[2m   Duration [22m 36.18s[2m (transform 32.34s, setup 32.41s, collect 72.27s, tests 3.93s, environment 300.56s, prepare 36.70s)[22m

